"use strict";
$.ajaxSetup({
    headers: {
        "X-CSRF-TOKEN": $('meta[name="csrf-token"]').attr("content")
    }
});

var Layout = function() {
    function e() {
        $(".sidenav-toggler").addClass("active"),
        $(".sidenav-toggler").data("action", "sidenav-unpin"),
        $("body").removeClass("g-sidenav-hidden").addClass("g-sidenav-show g-sidenav-pinned"),
        $("body").append('<div class="backdrop d-xl-none" data-action="sidenav-unpin" data-target=' + $("#sidenav-main").data("target") + " />"),
        Cookies.set("sidenav-state", "pinned")
    }
    function a() {
        $(".sidenav-toggler").removeClass("active"),
        $(".sidenav-toggler").data("action", "sidenav-pin"),
        $("body").removeClass("g-sidenav-pinned").addClass("g-sidenav-hidden"),
        $("body").find(".backdrop").remove(),
        Cookies.set("sidenav-state", "unpinned")
    }
    var t = Cookies.get("sidenav-state") ? Cookies.get("sidenav-state") : "pinned";
    $(window).width() > 1200 && ("pinned" == t && e(),
    "unpinned" == Cookies.get("sidenav-state") && a(),
    $(window).resize(function() {
        $("body").hasClass("g-sidenav-show") && !$("body").hasClass("g-sidenav-pinned") && $("body").removeClass("g-sidenav-show").addClass("g-sidenav-hidden")
    })),
    $(window).width() < 1200 && ($("body").removeClass("g-sidenav-hide").addClass("g-sidenav-hidden"),
    $("body").removeClass("g-sidenav-show"),
    $(window).resize(function() {
        $("body").hasClass("g-sidenav-show") && !$("body").hasClass("g-sidenav-pinned") && $("body").removeClass("g-sidenav-show").addClass("g-sidenav-hidden")
    })),
    $("body").on("click", "[data-action]", function(t) {
        t.preventDefault();
        var n = $(this)
          , i = n.data("action");
        n.data("target");
        switch (i) {
        case "sidenav-pin":
            e();
            break;
        case "sidenav-unpin":
            a();
            break;
        case "search-show":
            n.data("target"),
            $("body").removeClass("g-navbar-search-show").addClass("g-navbar-search-showing"),
            setTimeout(function() {
                $("body").removeClass("g-navbar-search-showing").addClass("g-navbar-search-show")
            }, 150),
            setTimeout(function() {
                $("body").addClass("g-navbar-search-shown")
            }, 300);
            break;
        case "search-close":
            n.data("target"),
            $("body").removeClass("g-navbar-search-shown"),
            setTimeout(function() {
                $("body").removeClass("g-navbar-search-show").addClass("g-navbar-search-hiding")
            }, 150),
            setTimeout(function() {
                $("body").removeClass("g-navbar-search-hiding").addClass("g-navbar-search-hidden")
            }, 300),
            setTimeout(function() {
                $("body").removeClass("g-navbar-search-hidden")
            }, 500)
        }
    }),
    $(".sidenav").on("mouseenter", function() {
        $("body").hasClass("g-sidenav-pinned") || $("body").removeClass("g-sidenav-hide").removeClass("g-sidenav-hidden").addClass("g-sidenav-show")
    }),
    $(".sidenav").on("mouseleave", function() {
        $("body").hasClass("g-sidenav-pinned") || ($("body").removeClass("g-sidenav-show").addClass("g-sidenav-hide"),
        setTimeout(function() {
            $("body").removeClass("g-sidenav-hide").addClass("g-sidenav-hidden")
        }, 300))
    }),
    $(window).on("load resize", function() {
        $("body").height() < 800 && ($("body").css("min-height", "100vh"),
        $("#footer-main").addClass("footer-auto-bottom"))
    })
}(),
    indexSplitSign = function (obj,is, sign = "." ,value) {
        if (typeof is == 'string'){
             return indexSplitSign(obj,is.split(sign), value);
        }else if (is.length==1 && value!==undefined){
            return obj[is[0]] = value;
        }else if (is.length==0){
            return obj;
        }else{
            return indexSplitSign(obj[is[0]],is.slice(1), value);
        }
    },
    base64toBlob = function (dataURI) {
        const byteString = atob(dataURI.split(",")[1]);
        const mimeString = dataURI.split(",")[0].split(":")[1].split(";")[0];
        const ab = new ArrayBuffer(byteString.length);
        const ia = new Uint8Array(ab);
        for (let i = 0; i < byteString.length; i++) {
            ia[i] = byteString.charCodeAt(i);
        }
        const blob = new Blob([ab], {
            type: mimeString
        });
        blob["lastModifiedDate"] = new Date().toISOString();
        blob["name"] = "file";
        switch (blob.type) {
            case "image/jpeg":
                blob["name"] += ".jpg";
                break;
            case "image/png":
                blob["name"] += ".png";
                break;
        }
        return blob;
    },
    Charts = (function () {
        var e, a = $('[data-toggle="chart"]'),
            t = "light",
            n = {
                base: "Open Sans"
            },
            i = {
                gray: {
                    100: "#f6f9fc",
                    200: "#e9ecef",
                    300: "#dee2e6",
                    400: "#ced4da",
                    500: "#adb5bd",
                    600: "#8898aa",
                    700: "#525f7f",
                    800: "#32325d",
                    900: "#212529"
                },
                theme: {
                    default: "#172b4d",
                    primary: "#5e72e4",
                    secondary: "#f4f5f7",
                    info: "#11cdef",
                    success: "#2dce89",
                    danger: "#f5365c",
                    warning: "#fb6340"
                },
                black: "#12263F",
                white: "#FFFFFF",
                transparent: "transparent"
            };

        function o(e, a) {
            for (var t in a)
                "object" != typeof a[t] ? (e[t] = a[t]) : o(e[t], a[t]);
        }

        function l(e) {
            var a = e.data("add"),
                t = $(e.data("target")).data("chart");
            e.is(":checked") ? (!(function e(a, t) {
                    for (var n in t)
                        Array.isArray(t[n]) ? t[n].forEach(function (e) {
                            a[n].push(e);
                        }) : e(a[n], t[n]);
                })(t, a),
                t.update()) : (!(function e(a, t) {
                    for (var n in t)
                        Array.isArray(t[n]) ? t[n].forEach(function (e) {
                            a[n].pop();
                        }) : e(a[n], t[n]);
                })(t, a),
                t.update());
        }

        function r(e) {
            var a = e.data("update"),
                t = $(e.data("target")).data("chart");
            o(t, a),
                (function (e, a) {
                    if (void 0 !== e.data("prefix") || void 0 !== e.data("prefix")) {
                        var t = e.data("prefix") ? e.data("prefix") : "",
                            n = e.data("suffix") ? e.data("suffix") : "";
                        (a.options.scales.yAxes[0].ticks.callback = function (e) {
                            if (!(e % 10))
                                return t + e + n;
                        }),
                        (a.options.tooltips.callbacks.label = function (e, a) {
                            var i = a.datasets[e.datasetIndex].label || "",
                                o = e.yLabel,
                                l = "";
                            return (a.datasets.length > 1 && (l += '<span class="popover-body-label mr-auto">' + i + "</span>"),
                                (l += '<span class="popover-body-value">' + t + o + n + "</span>"));
                        });
                    }
                })(e, t),
                t.update();
        }
        return (window.Chart && o(Chart, ((e = {
                    defaults: {
                        global: {
                            responsive: !0,
                            maintainAspectRatio: !1,
                            defaultColor: "dark" == t ? i.gray[700] : i.gray[600],
                            defaultFontColor: "dark" == t ? i.gray[700] : i.gray[600],
                            defaultFontFamily: n.base,
                            defaultFontSize: 13,
                            layout: {
                                padding: 0
                            },
                            legend: {
                                display: !1,
                                position: "bottom",
                                labels: {
                                    usePointStyle: !0,
                                    padding: 16
                                }
                            },
                            elements: {
                                point: {
                                    radius: 0,
                                    backgroundColor: i.theme.primary
                                },
                                line: {
                                    tension: 0.4,
                                    borderWidth: 4,
                                    borderColor: i.theme.primary,
                                    backgroundColor: i.transparent,
                                    borderCapStyle: "rounded"
                                },
                                rectangle: {
                                    backgroundColor: i.theme.warning
                                },
                                arc: {
                                    backgroundColor: i.theme.primary,
                                    borderColor: "dark" == t ? i.gray[800] : i.white,
                                    borderWidth: 4
                                }
                            },
                            tooltips: {
                                enabled: !0,
                                mode: "index",
                                intersect: !1
                            }
                        },
                        doughnut: {
                            cutoutPercentage: 83,
                            legendCallback: function (e) {
                                var a = e.data,
                                    t = "";
                                return (a.labels.forEach(function (e, n) {
                                        var i = a.datasets[0].backgroundColor[n];
                                        (t += '<span class="chart-legend-item">'),
                                        (t += '<i class="chart-legend-indicator" style="background-color: ' + i + '"></i>'),
                                        (t += e),
                                        (t += "</span>");
                                    }),
                                    t);
                            }
                        }
                    }
                }),
                Chart.scaleService.updateScaleDefaults("linear", {
                    gridLines: {
                        borderDash: [2],
                        borderDashOffset: [2],
                        color: "dark" == t ? i.gray[900] : i.gray[300],
                        drawBorder: !1,
                        drawTicks: !1,
                        drawOnChartArea: !0,
                        zeroLineWidth: 0,
                        zeroLineColor: "rgba(0,0,0,0)",
                        zeroLineBorderDash: [2],
                        zeroLineBorderDashOffset: [2]
                    },
                    ticks: {
                        beginAtZero: !0,
                        padding: 10,
                        callback: function (e) {
                            if (!(e % 10))
                                return e;
                        }
                    }
                }),
                Chart.scaleService.updateScaleDefaults("category", {
                    gridLines: {
                        drawBorder: !1,
                        drawOnChartArea: !1,
                        drawTicks: !1
                    },
                    ticks: {
                        padding: 20
                    },
                    maxBarThickness: 10
                }),
                e)),
            a.on({
                change: function () {
                    var e = $(this);
                    e.is("[data-add]") && l(e);
                },
                click: function () {
                    var e = $(this);
                    e.is("[data-update]") && r(e);
                }
            }), {
                colors: i,
                fonts: n,
                mode: t
            });
    })(),
    CopyIcon = (function () {
        var e, a = ".btn-icon-clipboard",
            t = $(a);
        t.length && ((e = t).tooltip().on("mouseleave", function () {
                e.tooltip("hide");
            }),
            new ClipboardJS(a).on("success", function (e) {
                $(e.trigger).attr("title", "Copied!").tooltip("_fixTitle").tooltip("show").attr("title", "Copy to clipboard").tooltip("_fixTitle"),
                    e.clearSelection();
            }));
    })(),
    Navbar = (function () {
        var e = $(".navbar-nav, .navbar-nav .nav"),
            a = $(".navbar .collapse"),
            t = $(".navbar .dropdown");
        a.on({
                "show.bs.collapse": function () {
                    var t;
                    (t = $(this)).closest(e).find(a).not(t).collapse("hide");
                }
            }),
            t.on({
                "hide.bs.dropdown": function () {
                    var e, a;
                    (e = $(this)),
                    (a = e.find(".dropdown-menu")).addClass("close"),
                        setTimeout(function () {
                            a.removeClass("close");
                        }, 200);
                }
            });
    })(),
    NavbarCollapse = (function () {
        $(".navbar-nav");
        var e = $(".navbar .navbar-custom-collapse");
        e.length && (e.on({
                "hide.bs.collapse": function () {
                    e.addClass("collapsing-out");
                }
            }),
            e.on({
                "hidden.bs.collapse": function () {
                    e.removeClass("collapsing-out");
                }
            }));
    })(),
    Popover = (function () {
        var e = $('[data-toggle="popover"]'),
            a = "";
        e.length && e.each(function () {
            !(function (e) {
                e.data("color") && (a = "popover-" + e.data("color"));
                var t = {
                    trigger: "focus",
                    template: '<div class="popover ' + a + '" role="tooltip"><div class="arrow"></div><h3 class="popover-header"></h3><div class="popover-body"></div></div>'
                };
                e.popover(t);
            })($(this));
        });
    })(),
    ScrollTo = (function () {
        var e = $(".scroll-me, [data-scroll-to], .toc-entry a");

        function a(e) {
            var a = e.attr("href") ? e.attr("href") : e.attr("scroll-to"),
                t = e.data("scroll-to-offset") ? e.data("scroll-to-offset") : 0,
                n = {
                    scrollTop: $(a).offset().top - t
                };
            $("html, body").stop(!0, !0).animate(n, 600),
                event.preventDefault();
        }
        e.length && e.on("click", function (e) {
            a($(this));
        });
    })(),
    Scrollbar = (function () {
        var e = $(".scrollbar-inner");
        e.length && e.scrollbar().scrollLock();
    })(),
    Tooltip = (function () {
        var e = $('[data-toggle="tooltip"]');
        e.length && e.each(function () {
            $(this).attr("data-placement", "left").attr("data-trigger", "hover").tooltip({
                animated: "fade",
                placement: "left",
                trigger: "hover"
            }).on("shown.bs.tooltip", function (e) {});
        });
    })(),
    Checklist = (function () {
        var e = $('[data-toggle="checklist"]');

        function a(e) {
            e.is(":checked") ? e.closest(".checklist-item").addClass("checklist-item-checked") : e.closest(".checklist-item").removeClass("checklist-item-checked");
        }
        e.length && (e.each(function () {
                $(this).find('.checklist-entry input[type="checkbox"]').each(function () {
                    a($(this));
                });
            }),
            e.find('input[type="checkbox"]').on("change", function () {
                a($(this));
            }));
    })(),
    FormControl = function () {
        var e = $(".form-control");
        e.length && e.on("focus blur", function (e) {
            $(this).parents(".form-group").toggleClass("focused", "focus" === e.type);
        }).trigger("blur");
    },
    color = "#5e72e4";
FormControl();

function GoogleMapsURLToEmbedURL(GoogleMapsURL) {
    var coords = /\@([0-9\.\,\-a-zA-Z]*)/.exec(GoogleMapsURL);
    if (coords != null) {
        var coordsArray = coords[1].split(",");
        return ("https://www.google.com/maps/embed?pb=!1m14!1m12!1m3!1d20000!2d" + coordsArray[1] + "!3d" + coordsArray[0] + "!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!5e0!3m2!1sen!2suk!4v1486486434098");
    }
}
var MapMarker = (function () {
    var e = $(".map-marker");
    e.length && e.each(function () {
        $(this).on("click", function (event) {
            event.preventDefault();
            var target = $(this).data("target");
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(function (position) {
                    var map_site = "@" + position.coords.latitude + "," + position.coords.longitude + ",18z";
                    $(target).val(map_site).trigger("input");
                });
            }
        });
    });
})();

function initMap() {
    (map = document.getElementById("map-default")),
    (lat = map.getAttribute("data-lat")),
    (lng = map.getAttribute("data-lng"));
    var e = new google.maps.LatLng(lat, lng),
        a = {
            zoom: 12,
            scrollwheel: !1,
            center: e,
            mapTypeId: google.maps.MapTypeId.ROADMAP
        };
    map = new google.maps.Map(map, a);
    var t = new google.maps.Marker({
            position: e,
            map: map,
            animation: google.maps.Animation.DROP,
            title: "Hello World!"
        }),
        n = new google.maps.InfoWindow({
            content: '<div class="info-window-content"><h2>Argon Dashboard PRO</h2><p>A beautiful premium dashboard for Bootstrap 4.</p></div>'
        });
    google.maps.event.addListener(t, "click", function () {
        n.open(map, t);
    });
}
($map = $("#map-default")).length && google.maps.event.addDomListener(window, "load", initMap);
var $map, map, lat, lng;
color = "#5e72e4";

function initMap() {
    (map = document.getElementById("map-custom")),
    (lat = map.getAttribute("data-lat")),
    (lng = map.getAttribute("data-lng"));
    var e = new google.maps.LatLng(lat, lng),
        a = {
            zoom: 18,
            scrollwheel: !1,
            center: e,
            mapTypeId: google.maps.MapTypeId.ROADMAP,
            styles: [{
                featureType: "administrative",
                elementType: "labels.text.fill",
                stylers: [{
                    color: "#444444"
                }]
            }, {
                featureType: "landscape",
                elementType: "all",
                stylers: [{
                    color: "#f2f2f2"
                }]
            }, {
                featureType: "poi",
                elementType: "all",
                stylers: [{
                    visibility: "off"
                }]
            }, {
                featureType: "road",
                elementType: "all",
                stylers: [{
                    saturation: -100
                }, {
                    lightness: 45
                }]
            }, {
                featureType: "road.highway",
                elementType: "all",
                stylers: [{
                    visibility: "simplified"
                }]
            }, {
                featureType: "road.arterial",
                elementType: "labels.icon",
                stylers: [{
                    visibility: "off"
                }]
            }, {
                featureType: "transit",
                elementType: "all",
                stylers: [{
                    visibility: "off"
                }]
            }, {
                featureType: "water",
                elementType: "all",
                stylers: [{
                    color: color
                }, {
                    visibility: "on"
                }]
            }]
        };
    map = new google.maps.Map(map, a);
    var t = new google.maps.Marker({
            position: e,
            map: map,
            animation: google.maps.Animation.DROP,
            title: $("#map-custom").data("title")
        }),
        n = new google.maps.InfoWindow({
            content: $(".info-map-content").html()
        });
    google.maps.event.addListener(t, "click", function () {
        n.open(map, t);
    });
}
($map = $("#map-custom")).length && google.maps.event.addDomListener(window, "load", initMap);
var BarStackedChart = (function () {
        var e, a, t, n, i = $("#chart-bar-stacked");
        i.length && ((e = i),
            (a = function () {
                return Math.round(100 * Math.random());
            }),
            (t = {
                labels: ["January", "February", "March", "April", "May", "June", "July"],
                datasets: [{
                    label: "Dataset 1",
                    backgroundColor: Charts.colors.theme.danger,
                    data: [a(), a(), a(), a(), a(), a(), a()]
                }, {
                    label: "Dataset 2",
                    backgroundColor: Charts.colors.theme.primary,
                    data: [a(), a(), a(), a(), a(), a(), a()]
                }, {
                    label: "Dataset 3",
                    backgroundColor: Charts.colors.theme.success,
                    data: [a(), a(), a(), a(), a(), a(), a()]
                }]
            }),
            (n = new Chart(e, {
                type: "bar",
                data: t,
                options: {
                    tooltips: {
                        mode: "index",
                        intersect: !1
                    },
                    responsive: !0,
                    scales: {
                        xAxes: [{
                            stacked: !0
                        }],
                        yAxes: [{
                            stacked: !0
                        }]
                    }
                }
            })),
            e.data("chart", n));
    })(),
    DoughnutChart = (function () {
        var e, a, t, n = $("#chart-doughnut");
        n.length && ((e = n),
            (a = function () {
                return Math.round(100 * Math.random());
            }),
            (t = new Chart(e, {
                type: "doughnut",
                data: {
                    labels: ["Danger", "Warning", "Success", "Primary", "Info"],
                    datasets: [{
                        data: [a(), a(), a(), a(), a()],
                        backgroundColor: [Charts.colors.theme.danger, Charts.colors.theme.warning, Charts.colors.theme.success, Charts.colors.theme.primary, Charts.colors.theme.info],
                        label: "Dataset 1"
                    }]
                },
                options: {
                    responsive: !0,
                    legend: {
                        position: "top"
                    },
                    animation: {
                        animateScale: !0,
                        animateRotate: !0
                    }
                }
            })),
            e.data("chart", t));
    })(),
    PieChart = (function () {
        var e, a, t, n = $("#chart-pie");
        n.length && ((e = n),
            (a = function () {
                return Math.round(100 * Math.random());
            }),
            (t = new Chart(e, {
                type: "pie",
                data: {
                    labels: ["Danger", "Warning", "Success", "Primary", "Info"],
                    datasets: [{
                        data: [a(), a(), a(), a(), a()],
                        backgroundColor: [Charts.colors.theme.danger, Charts.colors.theme.warning, Charts.colors.theme.success, Charts.colors.theme.primary, Charts.colors.theme.info],
                        label: "Dataset 1"
                    }]
                },
                options: {
                    responsive: !0,
                    legend: {
                        position: "top"
                    },
                    animation: {
                        animateScale: !0,
                        animateRotate: !0
                    }
                }
            })),
            e.data("chart", t));
    })(),
    PointsChart = (function () {
        var e, a, t = $("#chart-points");
        t.length && ((e = t),
            (a = new Chart(e, {
                type: "line",
                options: {
                    scales: {
                        yAxes: [{
                            gridLines: {
                                color: Charts.colors.gray[200],
                                zeroLineColor: Charts.colors.gray[200]
                            },
                            ticks: {}
                        }]
                    }
                },
                data: {
                    labels: ["May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"],
                    datasets: [{
                        label: "Performance",
                        data: [10, 18, 28, 23, 28, 40, 36, 46, 52],
                        pointRadius: 10,
                        pointHoverRadius: 15,
                        showLine: !1
                    }]
                }
            })),
            e.data("chart", a));
    })(),
    SalesChart = (function () {
        var e, a, t = $("#chart-sales-dark");
        t.length && ((e = t),
            (a = new Chart(e, {
                type: "line",
                options: {
                    scales: {
                        yAxes: [{
                            gridLines: {
                                color: Charts.colors.gray[700],
                                zeroLineColor: Charts.colors.gray[700]
                            },
                            ticks: {}
                        }]
                    }
                },
                data: {
                    labels: ["May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"],
                    datasets: [{
                        label: "Performance",
                        data: [0, 20, 10, 30, 15, 40, 20, 60, 60]
                    }]
                }
            })),
            e.data("chart", a));
    })(),
    BarsChart = ((SalesChart = (function () {
            var e, a, t = $("#chart-sales");
            t.length && ((e = t),
                (a = new Chart(e, {
                    type: "line",
                    options: {
                        scales: {
                            yAxes: [{
                                gridLines: {
                                    color: Charts.colors.gray[200],
                                    zeroLineColor: Charts.colors.gray[200]
                                },
                                ticks: {}
                            }]
                        }
                    },
                    data: {
                        labels: ["May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"],
                        datasets: [{
                            label: "Performance",
                            data: [0, 20, 10, 30, 15, 40, 20, 60, 60]
                        }]
                    }
                })),
                e.data("chart", a));
        })()),
        (function () {
            var e = $("#chart-bars");
            e.length && (function (e) {
                var a = new Chart(e, {
                    type: "bar",
                    data: {
                        labels: ["Jul", "Aug", "Sep", "Oct", "Nov", "Dec"],
                        datasets: [{
                            label: "Sales",
                            data: [25, 20, 30, 22, 17, 29]
                        }]
                    }
                });
                e.data("chart", a);
            })(e);
        })()),
    LineChart = (function () {
        var e, a, t = $("#chart-line");
        t.length && ((e = t),
            (a = new Chart(e, {
                type: "line",
                options: {
                    scales: {
                        yAxes: [{
                            gridLines: {
                                color: Charts.colors.gray[200],
                                zeroLineColor: Charts.colors.gray[200]
                            },
                            ticks: {}
                        }]
                    }
                },
                data: {
                    labels: ["May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"],
                    datasets: [{
                        label: "Performance",
                        data: [0, 20, 10, 30, 15, 40, 20, 60, 60]
                    }]
                }
            })),
            e.data("chart", a));
    })();

if ($('[data-toggle="widget-calendar"]')[0]) {
    var e = $('[data-toggle="widget-calendar"]');
    e.fullCalendar({
        contentHeight: "auto",
        theme: !1,
        buttonIcons: {
            prev: " ni ni-bold-left",
            next: " ni ni-bold-right"
        },
        header: {
            right: "next",
            center: "title, ",
            left: "prev"
        },
        editable: false,
        locale: $("html").attr("lang") ? $("html").attr("lang") : "en",
        events: {
            url: $('[data-toggle="widget-calendar"]').data("event-url"),
            type: "GET",
            dataType: "json",
            processData: true,
            contentType: "application/json",
            success: function (e, r, s) {},
            error: function () {}
        },
        eventRender: function (eventObj, $el) {
            $el.popover({
                title: eventObj.title,
                content: eventObj.description,
                trigger: "hover",
                placement: "top",
                container: "body"
            });
        }
    });
    var mToday = moment().format("dddd D, MMM YYYY"),
        mMonth = moment().format("MMM YYYY");
    $(".widget-calendar-today").html(mToday),
        $(".widget-calendar-month").html(mMonth);

    $("body").on("click", ".widget-calendar-btn-next", function (a) {
        a.preventDefault(),
            e.fullCalendar("next");
        mMonth = moment(e.fullCalendar("getDate")).format("MMM YYYY");
        $(".widget-calendar-month").html(mMonth);
    });

    $("body").on("click", ".widget-calendar-today", function (a) {
        a.preventDefault(),
            e.fullCalendar("today");
        mMonth = moment(e.fullCalendar("getDate")).format("MMM YYYY");
        $(".widget-calendar-month").html(mMonth);
    });

    $("body").on("click", ".widget-calendar-btn-prev", function (a) {
        a.preventDefault(),
            e.fullCalendar("prev");
        mMonth = moment(e.fullCalendar("getDate")).format("MMM YYYY");
        $(".widget-calendar-month").html(mMonth);
    });
}
var Fullcalendar = (function () {
        var e, a, t = $('[data-toggle="calendar"]');
        t.length && ((a = {
                header: {
                    right: "",
                    center: "",
                    left: ""
                },
                buttonIcons: {
                    prev: "calendar--prev",
                    next: "calendar--next"
                },
                theme: !1,
                selectable: !0,
                selectHelper: !0,
                editable: false,
                locale: $("html").attr("lang") ? $("html").attr("lang") : "en",
                allDayText: t.data("alldaytext"),
                events: {
                    url: t.data("event-url"),
                    error: function () {}
                },
                eventRender: function (eventObj, $el) {
                    $el.popover({
                        title: eventObj.title,
                        content: eventObj.description,
                        trigger: "hover",
                        placement: "top",
                        container: "body"
                    });
                },
                dayClick: function (e) {
                    var a = moment(e).toISOString();
                    $("#new-event").modal("show"),
                        $(".new-event--title").val(""),
                        $(".new-event--start").val(a),
                        $(".new-event--end").val(a);
                },
                viewRender: function (a) {
                    e.fullCalendar("getDate").month(),
                        $(".fullcalendar-title").html(a.title);
                },
                eventClick: function (e, a) {
                    $("#edit-event input[value=" + e.className + "]").prop("checked", !0),
                        $("#edit-event").modal("show"),
                        $(".edit-event--id").val(e.id),
                        $(".edit-event--title").val(e.title),
                        $(".edit-event--description").val(e.description);
                }
            }),
            (e = t).fullCalendar(a),
            $("body").on("click", ".new-event--add", function () {
                var a = $(".new-event--title").val(),
                    t = {
                        Stored: [],
                        Job: function () {
                            var e = Date.now().toString().substr(6);
                            return this.Check(e) ? this.Job() : (this.Stored.push(e),
                                e);
                        },
                        Check: function (e) {
                            for (var a = 0; a < this.Stored.length; a++)
                                if (this.Stored[a] == e)
                                    return !0;
                            return !1;
                        }
                    };
                "" != a ? (e.fullCalendar("renderEvent", {
                        id: t.Job(),
                        title: a,
                        start: $(".new-event--start").val(),
                        end: $(".new-event--end").val(),
                        allDay: !0,
                        className: $(".event-tag input:checked").val()
                    }, !0),
                    $(".new-event--form")[0].reset(),
                    $(".new-event--title").closest(".form-group").removeClass("has-danger"),
                    $("#new-event").modal("hide")) : ($(".new-event--title").closest(".form-group").addClass("has-danger"),
                    $(".new-event--title").focus());
            }),
            $("body").on("click", "[data-calendar]", function () {
                var a = $(this).data("calendar"),
                    t = $(".edit-event--id").val(),
                    n = $(".edit-event--title").val(),
                    i = $(".edit-event--description").val(),
                    o = $("#edit-event .event-tag input:checked").val(),
                    l = e.fullCalendar("clientEvents", t);
                "update" === a && ("" != n ? ((l[0].title = n),
                        (l[0].description = i),
                        (l[0].className = [o]),
                        e.fullCalendar("updateEvent", l[0]),
                        $("#edit-event").modal("hide")) : ($(".edit-event--title").closest(".form-group").addClass("has-error"),
                        $(".edit-event--title").focus())),
                    "delete" === a && ($("#edit-event").modal("hide"),
                        setTimeout(function () {
                            swal({
                                title: "Are you sure?",
                                text: "You won't be able to revert this!",
                                type: "warning",
                                showCancelButton: !0,
                                buttonsStyling: !1,
                                confirmButtonClass: "btn btn-danger",
                                confirmButtonText: "Yes, delete it!",
                                cancelButtonClass: "btn btn-secondary"
                            }).then(a => {
                                a.value && (e.fullCalendar("removeEvents", t),
                                    swal({
                                        title: "Deleted!",
                                        text: "The event has been deleted.",
                                        type: "success",
                                        buttonsStyling: !1,
                                        confirmButtonClass: "btn btn-primary"
                                    }));
                            });
                        }, 200));
            }),
            $("body").on("click", "[data-calendar-view]", function (a) {
                a.preventDefault(),
                    $("[data-calendar-view]").removeClass("active"),
                    $(this).addClass("active");
                var t = $(this).attr("data-calendar-view");
                e.fullCalendar("changeView", t);
            }),
            $("body").on("click", ".fullcalendar-btn-next", function (a) {
                a.preventDefault(),
                    e.fullCalendar("next");
            }),
            $("body").on("click", ".fullcalendar-btn-prev", function (a) {
                a.preventDefault(),
                    e.fullCalendar("prev");
            }));
    })(),
    DatatableBasic = (function () {
        var e = $("#datatable-basic");
        if (typeof $.fn.dataTable !== "undefined") {
            if (e.length && $.fn.dataTable.isDataTable("#datatable-basic")) {
                return false;
            }
            e.length && e.on("init.dt", function () {
                $("div.dataTables_length select").removeClass("custom-select custom-select-sm");
            }).DataTable({
                keys: !0,
                select: {
                    style: "multi"
                },
                language: {
                    paginate: {
                        previous: "<i class='fas fa-angle-left'>",
                        next: "<i class='fas fa-angle-right'>"
                    }
                }
            });
        }
    })(),
    DatatableAjax = (function () {
        var e = $('[data-toggle="datatable-ajax"]');
        if (typeof $.fn.dataTable !== "undefined") {
            $.fn.dataTable.ext.errMode = 'none';
            if (e.length && $.fn.dataTable.isDataTable('[data-toggle="datatable-ajax"]')) {
                return false;
            }

            var ajaxTableData = new AjaxTableData(e);
            var columns = [];
            $.each(ajaxTableData.getThead(),(i,th)=>{
                var column = {
                    data : th.key,
                    searchable : false,
                    orderable : false,
                };
                if(th.key == "id"){
                    column.orderable = true;
                }

                if(th.type == "checkbox"){
                    column.render = function ( data, type, row ) {
                        var checkedControls = e.find('[data-toggle="table-checked"]').data("checked-show-controls");
                        var td = '<div class="custom-control custom-checkbox">';
                            td += '<input class="custom-control-input" data-toggle="table-checked" id="table-check-' + row.id + '" data-checked-show-controls=\'' + JSON.stringify(checkedControls) + '\' type="checkbox" data-checked="table-checked" value="' + row.id + '">';
                            td += '<label class="custom-control-label" for="table-check-' + row.id + '"></label>';
                            td += '</div>';
                        return td;
                    };

                }else if(th.type == "image"){
                    column.render = function ( data, type, row ) {
                        var k_image = th.key.split(",");
                        var ct  = "";
                        $.each(k_image,(i,o)=>{
                            if(o){
                                ct += '<img data-src="'+indexSplitSign(row,o)+'" width="50" heigth="50">';
                            }

                        });
                        return ct;
                    };
                }else if(th.type == "icon"){
                    column.render = function ( data, type, row ) {

                        var icon  = th.element.data("icon") ? th.element.data("icon"):  "fas fa-check-circle";
                        var color = th.element.data("color") ? th.element.data("color"):  "text-green";
                        var sdisabled = "d-none";
                        if(indexSplitSign(row,th.key)){
                            icon  = th.element.data("icon") ? th.element.data("icon"):  "fas fa-check-circle";
                            color = th.element.data("color") ? th.element.data("color"):  "text-green";
                            var sdisabled = "";
                        }
                        return '<i id="'+row.id+'-set-cofirm" class="'+icon+' '+ color+' '+sdisabled+'"></i>'

                    }
                }else if(th.type == "option"){
                    column.render = function ( data, type, row ) {
                        var option = $('#datatable-ajax-option').clone();
                        var keys =  (th.key).split(',');
                            $.each(keys,(i,o)=>{
                                option.find("#btn-option-"+o).attr("href",row.action[o]);
                                if(o == "set"){
                                    var k_title = option.find("#btn-option-"+o).data("text");
                                    var k_image = option.find("#btn-option-"+o).data("image").split(",");
                                    var a_image = "";
                                    $.each(k_image,(i,o)=>{
                                        if(o){
                                            a_image += indexSplitSign(row,o)+ ",";
                                        }

                                    });

                                    option.find("#btn-option-"+o).attr("data-target","#"+row.id+"-set-cofirm")
                                    option.find("#btn-option-"+o).removeClass("card-frame-loaded");
                                    option.find("#btn-option-"+o).removeClass("certificate-frame-loaded");
                                    option.find("#btn-option-"+o).attr("data-id",row.id);
                                    option.find("#btn-option-"+o).attr("data-link",row.action[o]);
                                    option.find("#btn-option-"+o).attr("data-text",indexSplitSign(row,k_title));
                                    option.find("#btn-option-"+o).attr("data-image",a_image.slice(0, -1));

                                    if(row.status){
                                        option.find("#btn-option-"+o).addClass("disabled");
                                    }else{
                                        option.find("#btn-option-"+o).removeClass("disabled");
                                    }
                                }
                            });
                            option.find("[data-sweet-id]").removeClass("sweet-alert-loaded").attr("data-sweet-id",row.id);
                        return option.html();
                    }
                }else if(th.type == "link" && th.link){
                    column.render = function ( data, type, row ) {
                            var keys = th.key.split(",");
                            var ct = "";
                            $.each(keys,(i,o)=>{
                                if(o){
                                    ct += indexSplitSign(row,o) + th.join;
                                }

                            });
                            return '<a href="'+indexSplitSign(row,th.link)+'">'+ct+'</a>';
                    }
                }else if(th.type == "modal" && th.link){
                    column.render = function ( data, type, row ) {
                            return '<a href="'+indexSplitSign(row,th.link)+'" data-href="'+indexSplitSign(row,th.link)+'" data-checked-show="view" data-target="#modal" data-backdrop="static" data-keyboard="false">'+row[th.key]+'</a>';
                    }
                }else if(th.type == "text-image" && th.link){
                    column.render = function ( data, type, row ) {
                        if(th.element.data("reverse")){
                            return '<span class="mr-2"> '+indexSplitSign(row,th.key)+'</span><img data-src="'+indexSplitSign(row,th.link)+'" width="50" heigth="50">';
                        }else{
                            return '<img data-src="'+indexSplitSign(row,th.link)+'" width="50" heigth="50"><span class="ml-2"> '+indexSplitSign(row,th.key)+'</span>';
                        }

                    };
                }

                columns.push(column);
            });

            if(e.length)
            var order = "DESC";
            var api;
            var t = e.DataTable({
                lengthMenu: [
                    [10, 25, 50, 100, -1],
                    [10, 25, 50,100,"All"]
                ],
                //stateSave: true,
                ajax: {
                    "url": e.data("url"),
                    type: "GET",
                    processData: true,
                    contentType: "application/json",
                    dataType: "json",
                    error: function (xhr, error, code){
                        t.ajax.reload();
                    }
                },
                processing: true,
                serverSide: true,
                columns:  columns,
                language: window.datatable_i18n,
                order: [[1, order ]],
                fnDrawCallback : function(){
                     api = this.api();
                    FormModal();
                    sweetAlert();
                    TableChecked();
                    TableCheckedShow();
                    CardMaker();
                    CertificateMaker();
                    $('#datatable-ajax_paginate> .pagination').addClass("loaded");
                    if (lazyLoadInstance) {
                        lazyLoadInstance.update();
                    }

                },


            }).on("init.dt", function () {
                $("div.dataTables_length select").removeClass("custom-select custom-select-sm");
            }).on("order.dt", function (e) {
                if(t.order()){
                    order = t.order()[0][1];
                }

            }).on( 'processing.dt', function ( e, settings, processing ) {
                if(processing == false){
                    var start = api.page.info().start;
                    var recordsDisplay = api.page.info().recordsDisplay;
                    var record_generate_id = recordsDisplay - start;

                    t.column(1, {search:'applied', order:'applied'}).nodes().each( function (cell, i) {
                        if(order.toLowerCase() == "asc"){
                            cell.innerHTML = (start + i) + 1;
                        }else{
                            cell.innerHTML = record_generate_id --;
                        }

                    } );
                }

            });






        }
    })(),
    DatatableButtons = (function () {
        var e, a = $("#datatable-buttons");
        if (typeof $.fn.dataTable !== "undefined") {
            if (a.length && $.fn.dataTable.isDataTable("#datatable-buttons")) {
                return false;
            }
            a.length && ((e = {
                    lengthChange: !1,
                    dom: "Bfrtip",
                    buttons: ["copy", "print"],
                    language: {
                        paginate: {
                            previous: "<i class='fas fa-angle-left'>",
                            next: "<i class='fas fa-angle-right'>"
                        }
                    }
                }),
                a.on("init.dt", function () {
                    $(".dt-buttons .btn").removeClass("btn-secondary").addClass("btn-sm btn-default");
                }).DataTable(e));
        }
    })(),
    Dropzones = (function () {
        var e = $('[data-toggle="dropzone"]'),
            a = $(".dz-preview"),
            input = $("input");
        e.length && e.each(function () {
            var e, t, n, i, o;
            if (!$(this).data("dropzone")) {
                $(this).attr("data-dropzone", true);
                (e = $(this)),
                (t = void 0 !== e.data("dropzone-multiple")),
                (n = e.find(a)),
                (i = void 0),
                (o = {
                    url: e.data("dropzone-url"),
                    ignoreHiddenFiles: !1,
                    thumbnailWidth: null,
                    thumbnailHeight: null,
                    previewsContainer: n.get(0),
                    hiddenInputContainer: n.get(0),
                    paramName: e.find(input).attr("name"),
                    previewTemplate: n.html(),
                    dictDefaultMessage: e.find(input).attr("placeholder"),
                    maxFiles: t ? null : 1,
                    acceptedFiles: t ? null : "image/*",
                    maxFilesize: 5024,
                    init: function () {
                        this.on("addedfile", function (file) {
                            !t && i && this.removeFile(i),
                                (i = file);
                            n.parent().removeClass("has-error").parent().find(".invalid-feedback").remove();
                            e.find(".show.dz-preview-cover").remove();
                        });
                    }
                }),
                n.html(""),
                    e.dropzone(o),
                    e.addClass("dz-max-files-reached"),
                    e.find("input").after('<div class="show dz-preview-cover dz-processing dz-image-preview dz-success dz-complete">' + '<img class="dz-preview-img" src="' + e.data("dropzone-url") + '" alt="" data-dz-thumbnail="">' + "</div>");
            }
        });
    })(),
    Datepicker = (function () {
        var e = $(".datepicker");
        e.length && e.each(function () {
            $(this).datepicker({
                format: $(this).attr("data-format") ? $(this).attr("data-format") : "dd-mm-yyyy",
                startDate: $(this).attr("data-start-date") ? $(this).attr("data-start-date") : null,
                endDate: $(this).attr("data-end-date") ? $(this).attr("data-end-date") : null,
                todayHighlight: 1,
                //setDate: new Date(),
                disableTouchKeyboard: !0,
                autoclose: !1,
                language: $("html").attr("lang") ? $("html").attr("lang") : "en",
                minViewMode: $(this).attr("data-min-view") ? 1 : 0
            }).on("changeDate", function (e) {
                if ($(this).attr("name") == "date_of_birth") { //var getAge = birthDate=>Math.floor((new Date() - new Date(birthDate).getTime()) / 3.15576e10);
                    //$('[name="age"]').val(getAge(e.date)).trigger("input");
                }

                $(this).removeClass("has-error").parent().find(".invalid-feedback").remove();
            });
        });
    })(),
    noUiSliders = (function () {
        var el = $(".input-slider-container");
        el.length && el.each(function () {
            var e = $(this).find(".input-slider"),
                t = e.data("range-value-min"),
                n = e.data("range-value-max"),
                i = $(this).find(".range-slider-value"),
                l = i.data("range-value-low");

            noUiSlider.create(e[0], {
                orientation: e.data("orientation") ? e.data("orientation") : "horizontal",
                direction: e.data("direction") ? e.data("direction") : "ltr",
                start: [parseInt(l)],
                connect: [!0, !1],
                range: {
                    min: [parseInt(t)],
                    max: [parseInt(n)]
                }
            });
            e[0].noUiSlider.on("update", function (e, a) {
                $(this.target).parent().find("#input-slider-value").text(e[a]);
            });
        });
    })(),
    VectorMap = (function () {
        var e = $('[data-toggle="vectormap"]'),
            a = {
                gray: {
                    100: "#f6f9fc",
                    200: "#e9ecef",
                    300: "#dee2e6",
                    400: "#ced4da",
                    500: "#adb5bd",
                    600: "#8898aa",
                    700: "#525f7f",
                    800: "#32325d",
                    900: "#212529"
                },
                theme: {
                    default: "#172b4d",
                    primary: "#5e72e4",
                    secondary: "#f4f5f7",
                    info: "#11cdef",
                    success: "#2dce89",
                    danger: "#f5365c",
                    warning: "#fb6340"
                },
                black: "#12263F",
                white: "#FFFFFF",
                transparent: "transparent"
            };
        e.length && e.each(function () {
            var e, t;
            (e = $(this)),
            (t = {
                map: e.data("map"),
                zoomOnScroll: !1,
                scaleColors: ["#f00", "#0071A4"],
                normalizeFunction: "polynomial",
                hoverOpacity: 0.7,
                hoverColor: !1,
                backgroundColor: a.transparent,
                regionStyle: {
                    initial: {
                        fill: a.gray[200],
                        "fill-opacity": 0.8,
                        stroke: "none",
                        "stroke-width": 0,
                        "stroke-opacity": 1
                    },
                    hover: {
                        fill: a.gray[300],
                        "fill-opacity": 0.8,
                        cursor: "pointer"
                    },
                    selected: {
                        fill: "yellow"
                    },
                    selectedHover: {}
                },
                markerStyle: {
                    initial: {
                        fill: a.theme.warning,
                        "stroke-width": 0
                    },
                    hover: {
                        fill: a.theme.info,
                        "stroke-width": 0
                    }
                },
                markers: [{
                    latLng: [41.9, 12.45],
                    name: "Vatican City"
                }, {
                    latLng: [43.73, 7.41],
                    name: "Monaco"
                }, {
                    latLng: [35.88, 14.5],
                    name: "Malta"
                }, {
                    latLng: [1.3, 103.8],
                    name: "Singapore"
                }, {
                    latLng: [1.46, 173.03],
                    name: "Kiribati"
                }, {
                    latLng: [-21.13, -175.2],
                    name: "Tonga"
                }, {
                    latLng: [15.3, -61.38],
                    name: "Dominica"
                }, {
                    latLng: [-20.2, 57.5],
                    name: "Mauritius"
                }, {
                    latLng: [26.02, 50.55],
                    name: "Bahrain"
                }],
                series: {
                    regions: [{
                        values: {
                            AU: 760,
                            BR: 550,
                            CA: 120,
                            DE: 1300,
                            FR: 540,
                            GB: 690,
                            GE: 200,
                            IN: 200,
                            RO: 600,
                            RU: 300,
                            US: 2920
                        },
                        scale: [a.gray[400], a.gray[500]],
                        normalizeFunction: "polynomial"
                    }]
                }
            }),
            e.vectorMap(t),
                e.find(".jvectormap-zoomin").addClass("btn btn-sm btn-primary"),
                e.find(".jvectormap-zoomout").addClass("btn btn-sm btn-primary");
        });
    })(),
    Lavalamp = (function () {
        var e = $('[data-toggle="lavalamp"]');
        e.length && e.each(function () {
            $(this).lavalamp({
                setOnClick: !1,
                enableHover: !0,
                margins: !0,
                autoUpdate: !0,
                duration: 200
            });
        });
    })(),
    SortList = (function () {
        var e = $('[data-toggle="list"]'),
            a = $("[data-sort]");
        e.length && e.each(function () {
                var e;
                (e = $(this)),
                new List(e.get(0), (function (e) {
                    return {
                        valueNames: e.data("list-values"),
                        listClass: e.data("list-class") ? e.data("list-class") : "list"
                    };
                })(e));
                $(this).removeAttr("data-toggle").removeAttr("data-list-values");
            }),
            a.on("click", function () {
                return !1;
            });
    })(),
    Notify = (function () {
        var e = $('[data-toggle="notify"]');
        e.length && e.on("click", function (e) {
            e.preventDefault(),
                (function (e, a, t, n, i, o) {
                    $.notify({
                        icon: t,
                        title: " Bootstrap Notify",
                        message: "Turning standard Bootstrap alerts into awesome notifications",
                        url: ""
                    }, {
                        element: "body",
                        type: n,
                        allow_dismiss: !0,
                        placement: {
                            from: e,
                            align: a
                        },
                        offset: {
                            x: 15,
                            y: 15
                        },
                        spacing: 10,
                        z_index: 1080,
                        delay: 2500,
                        timer: 25e3,
                        url_target: "_blank",
                        mouse_over: !1,
                        animate: {
                            enter: i,
                            exit: o
                        },
                        template: '<div data-notify="container" class="alert alert-dismissible alert-{0} alert-notify" role="alert"><span class="alert-icon" data-notify="icon"></span> <div class="alert-text"</div> <span class="alert-title" data-notify="title">{1}</span> <span data-notify="message">{2}</span></div><button type="button" class="close" data-notify="dismiss" aria-label="Close"><span aria-hidden="true">&times;</span></button></div>'
                    });
                })($(this).attr("data-placement"), $(this).attr("data-align"), $(this).attr("data-icon"), $(this).attr("data-type"), $(this).attr("data-animation-in"), $(this).attr("data-animation-out"));
        });
    })(),
    OnScreen = (function () {
        var e, a = $('[data-toggle="on-screen"]');
        a.length && ((e = {
                container: window,
                direction: "vertical",
                doIn: function () {},
                doOut: function () {},
                tolerance: 200,
                throttle: 50,
                toggleClass: "on-screen",
                debug: !1
            }),
            a.onScreen(e));
    })(),
    CheckScreen = (function () {
        var e = $('[data-toggle="screen"]'),
            width = window.screen.width,
            height = window.screen.height;

        if (width > 1366) {
            e.each(function () {
                $(this).addClass("col-8 offset-2");
            });
        }
    })(),
    QuillEditor = (function () {
        var e = $('[data-toggle="quill"]');
        e.length && e.each(function () {
            var e, a;
            (e = $(this)),
            (a = e.data("quill-placeholder")),
            new Quill(e.get(0), {
                modules: {
                    toolbar: [
                        ["bold", "italic"],
                        ["link", "blockquote", "code", "image"],
                        [{
                            list: "ordered"
                        }, {
                            list: "bullet"
                        }]
                    ]
                },
                placeholder: a,
                theme: "snow"
            });
        });
    })();

function FormValidate(forms) {
    var e = forms ? forms : $("form[data-validate]");
    e.length && e.each(function () {
        if ($(this).data("validate")) {
            $(this).attr({
                hasValidate: true
            }).unbind().validation({
                request_field: $(this).data("validate"),
                onValidate: (validation) => {

                }
            });
            if ($(this).attr("role") == "view") {
                $(this).convertFormTag({
                    dataNameTag: $(this).data("validate").attributes
                });
            }

            $(this).removeAttr("data-validate");
        }
    });
}

FormValidate();

function FormQuizAnswer(forms) {
    var e = forms ? forms : $("form#form-quiz-answer");
    e.length && e.each(function () {
        var self = $(this);
        if (self.data("validation")) {
            var load = $('<span class="loading ml-2"><img src="' + location.origin + '/assets/img/icons/LOOn0JtHNzb.gif"></span>');
            var c = $(this).find('#edit').data("control");
            $(this).unbind().attr({
                hasValidate: true
            }).validation({
                request_field: $(this).data("validation"),
                onBeforeSend: (xhr, loading) => {

                    $(this).find('[name="' + c + '"]').attr("disabled", "disabled");
                    $(this).find('button[type="submit"]').append(load);
                },
                onSuccess: (response) => {
                    load.remove();
                    if (response.success) {
                        if (response.type == "add") {
                            var answered_lable = $(this).find('#answer-label').data("update-text")
                            $(this).find('#answer-label').html(answered_lable);
                            $(this).find('button#cancel').addClass("d-none");
                            $(this).find('button#edit').removeClass("d-none");
                            $(this).find('button[type="submit"]').addClass("d-none");
                            $(this).find('[name="id"]').val(response.data.id);

                            $(this).find('[name="answer"]').replaceWithTag("span").html(response.data.answered).removeAttr("disabled");

                            var action = $(this).attr("action");
                            $(this).attr("action", action.replace("add", "update"));
                            FormQuizAnswer($(this));
                        } else if (response.type == "update") {

                            $(this).find('[name="answer"]').replaceWithTag("span").html(response.data.answered).removeAttr("disabled");

                            $(this).find('[name="marks"]').replaceWithTag("span").html(response.data.marks).removeAttr("disabled");

                            $(this).find("button#edit").removeClass("d-none");
                            $(this).find("button#cancel").addClass("d-none");
                            $(this).find('button[type="submit"]').addClass("d-none");
                            $(this).find("button#cancel").trigger("click");
                        }

                        // swal({
                        //     showCloseButton: false,
                        //     title: response.message.title,
                        //     text: response.message.text,
                        //     type: "success",
                        //     buttonsStyling: !1,
                        //     showCloseButton: true,
                        //     confirmButtonClass: "btn btn-success",
                        //     confirmButtonText: response.message.button.confirm,
                        //     onClose: ()=>{
                        //         if($(this).parents(".modal").length){
                        //             $(this).parents(".modal").modal("hide");
                        //         }

                        //     }
                        // });
                    }
                },

            });
            $(this).removeAttr("data-validation");
        }

        self.find("button#edit").unbind().on("click", function (e) {

            e.preventDefault();
            var utext = $(this).parents("form").find('button[type="submit"]').data("update-text");
            var action = $(this).parents("form").attr("action").replace("add", "update");
            $(this).parents("form").find('button[type="submit"]').removeClass("d-none").html(utext);

            var c = $(this).data("control");
            var ctag = $(this).data("change-tag");
            var attr_remove = $(this).data("attr-remove");

            $(this).addClass("d-none");
            $(this).parents("form").find('[name="' + c + '"]').replaceWithTag(ctag).autogrow().removeClass("d-none").val($(this).parents("form").find('[name="' + c + '"]').text()).focus();
            if (attr_remove) {
                attr_remove = (typeof attr_remove == "string") ? attr_remove.split(",") : attr_remove;
                $.each(attr_remove, (i, f) => {
                    $(this).parents("form").find('[name="' + c + '"]').removeAttr(f);
                });
            }
            $(this).parents("form").attr("action", action);
            $(this).parents("form").find('button#cancel').removeClass("d-none");

            self.find('[name]').removeAttr("disabled").focus();
        });

        self.find("button#cancel").unbind().on("click", function (e) {
            e.preventDefault();
            var c = $(this).data("control");
            var ctag = $(this).data("change-tag");
            $(this).addClass("d-none");
            $(this).parents("form").find('[name="' + c + '"]').removeClass("rounded-right").removeClass("has-error").parent().find(".invalid-feedback").remove();
            $(this).parents("form").find("button#edit").removeClass("d-none");
            $(this).parents("form").find('[name="' + c + '"]').replaceWithTag(ctag);
            $(this).parents("form").find('button[type="submit"]').addClass("d-none");
            self.find('[name]').attr("disabled", true);
        });

    });
}
FormQuizAnswer();

function FormCourseRoutine(forms) {
    var e = $('[data-toggle="course-routine"]');
    e.length && e.each(function () {
        var table = new Table(this);
        $.each($(table.element).find('[data-merge]'), (i, ss) => {
            var m = $(ss).data("merge");
            var cells = table.element.querySelectorAll('[data-merge="' + m + '"]');

            $(ss).removeAttr("data-merge");
            table.merge(cells);
        });
    });

    var e = forms ? forms : $("form#form-course-routine");
    e.length && e.each(function () {

        var courseRoutine = new CourseRoutine($(this).find('[data-toggle="course-routine"]'));
        courseRoutine.build();

        if ($(this).data("validation")) {
            var loading = $('<div class="loading" style="background-color: rgba(0, 0, 0, 0.4); position: absolute; height: 100%; width: 100%; z-index: 2;"><div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);"><div class="spinner-border spinner-3 text-blue"></div></div></div>');
            var load = $('<span class="loading ml-2"><img src="' + location.origin + '/assets/img/icons/LOOn0JtHNzb.gif"></span>');

            $(this).unbind().attr({
                hasValidate: true
            }).validation({
                request_field: $(this).data("validation"),
                onBeforeSend: (xhr, loading) => {
                    $(this).find('button[type="submit"]').append(load);

                    $(this).parent().prepend(loading);
                },
                onSuccess: (response) => {
                    load.remove();
                    loading.remove();
                    if (response.success) {
                        swal({
                            showCloseButton: false,
                            title: response.message.title,
                            text: response.message.text,
                            type: "success",
                            buttonsStyling: !1,
                            showCloseButton: true,
                            confirmButtonClass: "btn btn-success",
                            confirmButtonText: response.message.button.confirm,
                            onClose: () => {
                                if ($(this).parents(".modal").length) {
                                    $(this).parents(".modal").modal("hide");
                                }
                            }
                        });
                        $('[data-toggle="cotent-refresh"]').trigger("click");

                    } else if (response.hasOwnProperty("errors") && Object.values(response.errors).length) {
                        validation.validate(response.errors, this);
                    } else {
                        swal({
                            showCloseButton: false,
                            title: response.message.title,
                            html: response.message.text.replace(/\n/g, "<br>"),
                            type: "warning",
                            buttonsStyling: !1,
                            confirmButtonClass: "btn btn-primary",
                            confirmButtonText: response.message.button.confirm,
                            cancelButtonClass: "btn btn-secondary",
                            cancelButtonText: response.message.button.cancel
                        });
                    }
                },
                onSubmit: (event, validation) => {
                    event.preventDefault();
                    var fields = $(this).serializeArray().reduce(function (obj, item) {
                        obj[item.name] = item.value;
                        return obj;
                    }, {});
                    var formData = courseRoutine.formData();
                    formData.append("study_course_session", $(this).find('[name="study_course_session"]').val());
                    if (validation.validate(fields, this)) {
                        $.ajax({
                            url: $(this).attr("action"),
                            method: "POST",
                            data: formData,
                            processData: false,
                            contentType: false,
                            beforeSend: xhr => {},
                            success: (response) => {
                                if (response.success) {
                                    swal({
                                        showCloseButton: false,
                                        title: response.message.title,
                                        text: response.message.text,
                                        type: "success",
                                        buttonsStyling: !1,
                                        showCloseButton: true,
                                        confirmButtonClass: "btn btn-success",
                                        confirmButtonText: response.message.button.confirm,
                                        onClose: () => {
                                            if ($(this).parents(".modal").length) {
                                                $(this).parents(".modal").modal("hide");
                                            }

                                        }
                                    });
                                } else if (response.hasOwnProperty("errors") && Object.values(response.errors).length) {
                                    validation.validate(response.errors, this);
                                } else {
                                    swal({
                                        showCloseButton: false,
                                        title: response.message.title,
                                        html: response.message.text.replace(/\n/g, "<br>"),
                                        type: "warning",
                                        buttonsStyling: !1,
                                        confirmButtonClass: "btn btn-primary",
                                        confirmButtonText: response.message.button.confirm,
                                        cancelButtonClass: "btn btn-secondary",
                                        cancelButtonText: response.message.button.cancel
                                    });
                                }
                            }
                        });
                    }

                },
            });
            $(this).removeAttr("data-validation");
        }

    });
}
FormCourseRoutine();

function FormLesson(forms) {
     var e = forms ? forms : $("form#form-lesson");
    e.length && e.each(function () {
        if ($(this).data("validation")) {

            var loading = $('<div class="loading" style="background-color: rgba(0, 0, 0, 0.4); position: absolute; height: 100%; width: 100%; z-index: 2;"><div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);"><div class="spinner-border spinner-3 text-blue"></div></div></div>');
            var load = $('<span class="loading ml-2"><img src="' + location.origin + '/assets/img/icons/LOOn0JtHNzb.gif"></span>');

            $(this).unbind().attr({
                hasValidate: true
            }).validation({
                request_field: $(this).data("validation"),
                onSubmit: (event, validation) => {
                    event.preventDefault();
                    var fields = $(this).serializeArray().reduce(function (obj, item) {
                        obj[item.name] = item.value;
                        return obj;
                    }, {});
                    var formData = new FormData(this);

                        if($(this).find('[name="image"]').get(0).files.length == 0){
                            var info = $(this).find('[name="image"]').attr("data-pdf-info");
                            if(info){
                                info = JSON.parse(info);
                                formData.delete("image");
                                formData.append("image", base64toBlob(info.base64));
                            }

                        }




                    if (validation.validate(fields, this)) {
                        $.ajax({
                            url: $(this).attr("action"),
                            method: "POST",
                            data: formData,
                            processData: false,
                            contentType: false,
                            beforeSend: xhr => {
                                $(this).find('button[type="submit"]').append(load);
                                $(this).parent().prepend(loading);
                            },
                            success: (response) => {
                                load.remove();
                                loading.remove();
                                if (response.success) {
                                    if ($('[data-toggle="ajax-table-data"]').length) {
                                        $('[data-toggle="ajax-table-data"]').each(function () {
                                            var ajaxTableData = new AjaxTableData($(this));
                                            ajaxTableData.build(response.data);
                                        });
                                        $.getScript(location.origin + "/assets/js/argon.min.js").done((response, type, xhr) => {
                                            if (type == "success") {}
                                        });
                                    }
                                    if($('[data-toggle="datatable-ajax"]').length){
                                        $('[data-toggle="datatable-ajax"]').each(function () {
                                            var t = $(this).DataTable();
                                                t.ajax.reload();
                                        });
                                    }
                                    swal({
                                        showCloseButton: false,
                                        title: response.message.title,
                                        text: response.message.text,
                                        type: "success",
                                        buttonsStyling: !1,
                                        showCloseButton: true,
                                        confirmButtonClass: "btn btn-success",
                                        confirmButtonText: response.message.button.confirm,
                                        onClose: () => {
                                            if ($(this).parents(".modal").length) {
                                                $(this).parents(".modal").modal("hide");
                                            }

                                        }
                                    });
                                } else if (response.hasOwnProperty("errors") && Object.values(response.errors).length) {
                                    validation.validate(response.errors, this);
                                } else {
                                    swal({
                                        showCloseButton: false,
                                        title: response.message.title,
                                        html: response.message.text.replace(/\n/g, "<br>"),
                                        type: "warning",
                                        buttonsStyling: !1,
                                        confirmButtonClass: "btn btn-primary",
                                        confirmButtonText: response.message.button.confirm,
                                        cancelButtonClass: "btn btn-secondary",
                                        cancelButtonText: response.message.button.cancel
                                    });
                                }
                            }
                        });
                    }

                },
            });
            $(this).removeAttr("data-validation");
        }

    });
}
FormLesson();

var FormModal = function () {
        var e = $('[data-toggle="modal"]');
        e.length && e.each(function () {
            $(this).unbind("click").on("click", function (e) {
                $(".modal[id^=modal-]").remove();
                e.preventDefault();
                var ajaxModal = new AjaxFormModal();
                ajaxModal.set({
                    element: $(this),
                    modalContainer: $(".modal#modal"),
                    url: $(this).attr("href"),
                    method: "GET",
                    onCompleted: (xhr, type, modalBody) => {
                        if (type == "success") {
                            modalBody.show();
                        }
                    }
                });
                ajaxModal.load();
            });
        });
    }
    FormModal();

    var Select2 = function (selectContainer = null, selected = 0) {
        var e = selectContainer ? selectContainer : $('[data-toggle="select"]');
        e.length && e.each(function () {
            var query = $(this).data("query-url");

            var ajax = {
                // url: $(this).attr("data-ajax"),
                url: function () {
                    if (query) {
                        query = typeof query == "string" ? query.split(",") : query;
                        var q = "";

                        $.each(query, (i, f) => {
                            q += f.replace("study_", "").replace("academic_", "") + "Id=" + $(this).parents("form").find("#" + f).val() + "&";
                        });
                        return $(this).attr("data-ajax") + "?" + q;
                    } else {
                        return $(this).attr("data-ajax");
                    }
                },
                type: "GET",
                dataType: "json",
                processData: true,
                contentType: "application/json",
                processResults: function (response, params) {
                    params.page = response.pages.current_page;

                    return {
                        results: $.map(response.data, function (obj) {
                            return {
                                id: obj.id,
                                text: $.inArray("name", Object.keys(obj)) != -1 ? obj.name : obj.first_name + " " + obj.last_name + " - " + obj._fullname,
                                image: $.inArray("image", Object.keys(obj)) != -1 ? obj.image : obj.photo
                            };
                        }),
                        pagination: {
                            more: params.page == response.pages.last_page ? false : true
                        }
                    };
                },
                data: function (params) {
                    var query = {
                        page: params.page,
                        search: params.term
                    };
                    return query;
                }
            };
            $(this).unbind().select2({
                closeOnSelect: $(this).attr("multiple") ? false : true,
                // theme: "bootstrap",
                width: "resolve",
                dropdownPosition: "auto",
                templateResult: function (item) {
                    if (!item.id) {
                        return item.text;
                    }

                    var container = $("<span>").addClass("row px-3"),
                        image = $("<span>").addClass("col-auto p-0"),
                        text = $("<span>").addClass("col p-0 ml-2").html(" " + item.text),
                        img = $("<img>").css({
                            class: "image",
                            width: 26,
                            height: 26,
                            objectFit: 'cover'
                        });

                    if ($(item.element).data("src")) {
                        img.attr("src", $(item.element).data("src"));
                        img.appendTo(image);
                        image.appendTo(container);
                    } else if ($.inArray("image", Object.keys(item)) != -1 && item.image) {
                        img.attr("src", item.image);
                        img.appendTo(image);
                        image.appendTo(container);
                    }

                    text.appendTo(container);
                    return container;
                },
                templateSelection: function (item) {
                    var span = $("<span>", {
                            text: " " + item.text
                        }),
                        img = $("<img>").css({
                            class: "image",
                            width: 26,
                            height: 26,
                            objectFit: 'cover'
                        });
                    if ($(item.element).data("src")) {
                        img.attr("src", $(item.element).data("src"));
                        span.prepend(img);
                    } else if ($.inArray("image", Object.keys(item)) != -1 && item.image) {
                        img.attr("src", item.image);
                        span.prepend(img);
                    }
                    return span;
                },
                ajax: $(this).data("ajax") ? ajax : null,

            });

            if (selectContainer) {
                $(this).val(selected).trigger("change");
            } else {
                $(this).val($(this).data("select-value") ? $(this).attr("data-select-value").split(",") : 0).trigger("change");
            }
            var ajaxChange = null;
            $(this).on("change", function () {
                var self = this,
                    url = $(self).data("append-url"),
                    to = $(self).data("append-to"),
                    id = $(to).attr("id"),
                    con2 = $(self).parents("form").find("#select2-" + id + "-container");

                if (url && $(self).val()) {
                    if (ajaxChange) {
                        ajaxChange.abort();
                    }
                    ajaxChange = $.ajax({
                        url: url + $(self).val(),
                        method: "GET",
                        processData: true,
                        contentType: "application/json",
                        dataType: "json",
                        beforeSend: function (xhr) {
                            $(self).parents("form").find(to).attr("disabled", "disabled");
                            con2.removeAttr("title").html('<div class="spinner"></div>');
                        },
                        success: function (response) {
                            if (response.success) {
                                var data = $.map(response.data, obj => {
                                    var img = $.inArray("image", Object.keys(obj)) != -1 ? obj.image : obj.photo;
                                    var name = $.inArray("name", Object.keys(obj)) != -1 ? obj.name : obj.first_name + " " + obj.last_name + " - " + obj._fullname;
                                    return ('<option data-src="' + img + '" value="' + obj.id + '">' + name + "</option>");
                                });
                                $(self).parents("form").find(to).removeAttr("disabled").html(data).removeClass("has-error").parent().find(".invalid-feedback").remove();
                                $(self).parents("form").find(to).attr("data-ajax", url + $(self).val());

                                $(self).parents("form").find(to).select2("destroy");
                                Select2($(self).parents("form").find(to), $(self).parents("form").find(to).attr("data-select-value"));
                            } else {
                                $(self).parents("form").find(to).attr("disabled", "disabled");
                                con2.addClass("text-center").html('<span class="select2-selection__placeholder"><span class="text-red"> ' + response.message + " </span></span>");
                            }
                        }
                    });
                } else {
                    $(self).parents("form").find(to).attr("disabled", "disabled").val(0).trigger("change");
                }
            });

            $(this).on("select2:select", function (e) {
                $(this).removeClass("has-error").parent().find(".invalid-feedback").remove();
                $(this).parent().find(".select2-selection").removeClass("has-error");
            });
            $(this).on("select2:open", function (e) {
                var self = this,
                    container = $("<div>").addClass("add-option border-top"),
                    url = $(self).data("url"),
                    id = $(self).attr("id"),
                    text = $(self).data("text");
                if (url && text && $("#select2-" + id + "-results").parent().find(".add-option").length == 0) {
                    var a = $("<a>").attr({
                        "data-toggle": "modal",
                        "data-target": "#modal-" + id,
                        href: url,
                        class: "d-block p-2"
                    }).css({
                        color: "#0096ec"
                    }).html('<i class="fal fa-plus"></i><span class="ml-2">' + text + "</span></a>").appendTo(container);

                    container.unbind().on("click", function (event) {
                        event.preventDefault();
                        var modal = $(".modal:last").clone();
                        modal.attr("id", "modal-" + id).removeClass("show").find(".data-select2-id").removeAttr("data-select2-id");
                        modal.find(".card-body:first").html("");
                        modal.find(".modal-header").html("");
                        modal.find(".modal-footer").html("");
                        modal.find(".modal-dialog").attr("class", "modal-dialog modal-dialog-centered modal-dialog-scrollable");

                        if ($("#modal-" + id).length == 0) {
                            $(".modal:last").after(modal);
                        }

                        var ajaxModal = new AjaxFormModal();
                        ajaxModal.set({
                            element: self,
                            modalContainer: modal,
                            url: url,
                            method: "GET",
                            onCompleted: (xhr, type, modalBody) => {
                                if (type == "success") {
                                    modalBody.show();
                                }
                            }
                        });
                        ajaxModal.load();

                        modal.on("show.bs.modal", function () {
                            $(self).select2("close");
                        }).on("hidden.bs.modal", function () {
                            $(".modal[id^=modal-]").remove();
                        });
                    });

                    // $(".select2-results:not(:has(.add-option))").append(
                    //     container
                    // );
                }
            });
            $(this).on("select2:close", function (e) {
                $(".modal[id^=modal-]").remove();
            });

            //$(this).on("select2:unselect", function (e) { console.log("select2:unselect", e); });
        });
    };
Select2();

var Radio = (function () {
        var e = $('input[data-toggle="radio"]');
        e.length && e.each(function (i) {
            $(this).on("change", function (e) {
                $(this).parents(".custom-control.custom-radio.custom-control-inline").parent().find(".has-error").removeClass("has-error");
                $(this).parents(".custom-control.custom-radio.custom-control-inline").parent().find(".has-success").removeClass("has-success");
                $(this).parents(".custom-control.custom-radio.custom-control-inline").parent().removeClass("has-error").addClass("has-success").find(".invalid-feedback").remove();

                if ($(this).attr("data-hide-collapse")) {
                    var id = "#" + $(this).attr("data-hide-collapse");
                    $(id).hide("slow");
                }
                if ($(this).attr("data-show-collapse")) {
                    var id = "#" + $(this).attr("data-show-collapse");
                    $(id).show("slow");
                }
            });
        });
    })(),
    Tags = (function () {
        var e = $('[data-toggle="tags"]');
        e.length && e.each(function () {
            $(this).tagsinput({
                tagClass: "badge badge-primary"
            });
        });
    })(),
    SameValues = (function () {
        var e = $('[data-toggle="same-values"]');
        e.length && e.each(function () {
            $(this).unbind().on("click", function (event) {
                event.preventDefault();
                var dataSame = $(this).attr("data-same-value");
                var dataAppend = $(this).attr("data-append-value");
                var containerDataSame = $('[data-control-value-id="' + dataSame + '"]');
                var containerdataAppend = $('[data-control-value-id="' + dataAppend + '"]');
                containerDataSame.find("[name]").each(function (i) {
                    if (containerDataSame.find("[name]").length == containerdataAppend.find("[name]").length) {
                        var val = $(this).val();
                        if (val) {
                            if (containerdataAppend.find("[name]")[i].tagName == "SELECT") {
                                $(containerdataAppend.find("[name]")[i]).attr("data-select-value", val).val(val).trigger("change");
                            } else {
                                $(containerdataAppend.find("[name]")[i]).val(val).trigger("input");
                            }
                        }
                    }
                });
            });
        });
    })(),
    Collapse = (function () {
        var e = $("[data-toggle-collapse]");
        e.length && e.each(function () {
            $(this).on("show.bs.collapse", function () {
                console.log($(this));
                var dataCollapse = $(this).attr("data-toggle-collapse");
                if (dataCollapse) {
                    $('[data-collapse="' + dataCollapse + '"]').hide("slow");
                }
            }).on("hidden.bs.collapse", function () {
                var dataCollapse = $(this).attr("data-toggle-collapse");
                if (dataCollapse) {
                    $('[data-collapse="' + dataCollapse + '"]').show("slow");
                }
            });
        });
    })(),
    lazyLoadInstance = typeof LazyLoad === "undefined" ? null : new LazyLoad({
        callback_loaded: el => {
            var dataAlt = $(el).attr("data-alt"),
                dataSrc = $(el).attr("data-src"),
                dataWasProcessed = $(el).attr("data-was-processed"),
                dataClass = "loaded";
            $(el).parent().find(".swiper-lazy-preloader").remove();
            $(el).attr("alt", dataAlt);
            $(el).removeAttr("data-alt");
            $(el).removeAttr("data-src");
        },
        callback_error: el => {
            if ($(el).attr("src")) {
                var src = $(el).attr("src");
                el.src = src;
            }
            lazyLoadInstance.update();
        }
    }),
    Textarea = (function () {
        var e = $("textarea");
        e.length && e.each(function () {
            $(this).autogrow();
        });
    })(),
    ModalShow = (function () {
        var modalOnShow = (modal = null) => {
            if (modal) {
                modal.find("[data-modal-change-class]").each(function () {
                    var newClass = $(this).attr("data-modal-change-class");
                    $(this).attr({
                        class: newClass
                    }).removeAttr("data-modal-change-class");
                });
            } else {
                $(this).find("[data-modal-change-class]").each(function () {
                    var newClass = $(this).attr("data-modal-change-class");
                    $(this).attr({
                        class: newClass
                    }).removeAttr("data-modal-change-class");
                });
            }
        };
        modalOnShow();
    })();
if (lazyLoadInstance) {
    lazyLoadInstance.loadAll();
}
var Clones = function () {
    var e = $('[data-toggle="clone"]');
    e.length && e.each(function () {
        $(this).unbind("click").on("click", function (event) {
            event.preventDefault();
            var from = $(this).attr("data-clone-from"),
                clone = $('[data-clone="' + from + '"]:last').clone();
            clone.find("[name]").each(function () {
                if ($(this).attr("type") == "checkbox") {
                    $(this).prop("checked", false);
                } else {
                    $(this).val(null);
                }

                // var name = $(this).attr("name").replace("[", "").replace("]", "");
                // clone.find('[id="has-error-for-' + name +'"]').remove();
            });
            if ($(this).data("name")) {
                var cn = $(this).data("name").split(",");
                var target_cn = $(this).data("target-change").split(",");
                if (cn && target_cn) {
                    $.each(target_cn, (i) => {
                        clone.find(target_cn[i]).attr("name", cn[i]);
                    });

                }
            }


            clone.find('input[type="checkbox"]').removeAttr("data-fixed");

            var $i = 1;
            $(this).parents('[data-clone="' + from + '"]').parent().find("select[name]").each(function (i) {
                $(this).select2("destroy");
                Select2($(this));
                $i++;
            });

            $(this).parents('[data-clone="' + from + '"]').after(clone);

            clone.find(".select2-container").remove();
            clone.find('[data-toggle="collapse"]').each(function (i) {
                clone.find($(this).attr("href")).attr({
                    id: "_" + from + i
                });
                $(this).attr({
                    href: "#_" + from + i,
                    "aria-controls": "_" + from + i
                });
            });
            if (clone.find("select[name][data-append-to]")) {
                clone.find("select[name][data-append-to]").each(function () {
                    var oldId = $(this).attr("data-append-to"),
                        newId = $(this).attr("data-append-to") + $i;

                    $(this).attr("data-append-to", newId);
                    clone.find(oldId).attr({
                        id: newId.replace("#", ""),
                        disabled: "disabled"
                    }).html("");
                });
            }

            Select2(clone.find("select[name]"));
            $(this).parents('[data-clone="' + from + '"]').parent().find('[data-clone-delete="' + from + '"]').removeClass("invisible");

            $(this).parents('[data-clone="' + from + '"]').parent().find('input[type="checkbox"]:not([data-fixed])').each(function (idx) {
                var newId = $(this).attr("id").split("-");
                $(this).attr("name", newId[0] + "[" + idx + "]");
                newId = newId[0] + "-" + idx;
                $(this).attr("id", newId);
                $(this).parent().find("label").attr("for", newId);
            });

            Clones();
            FormControl();
        });
    });

    var e = $("[data-clone-delete]");
    e.length && e.each(function () {
        $(this).unbind().on("click", function (e) {
            e.preventDefault();
            var del = $(this).attr("data-clone-delete");
            if ($(this).parents("[data-clone=" + del + "]").parent().children().length > 1) {
                if ($(this).parents("[data-clone=" + del + "]").parent().children().length == 2) {
                    $(this).parents("[data-clone=" + del + "]").parent().find("[data-clone-delete]").addClass("invisible");
                }

                $(this).parents("[data-clone=" + del + "]").remove();
            }
        });
    });
};
Clones();
var ChangeText = (function () {
        var e = $("[data-change-text]");
        e.length && e.each(function () {
            $(this).change(function (e) {
                var text = $(this).find('[value="' + $(this).val() + '"]').attr("data-text");

                $.each($(this).attr("data-change-text").split(","), function (i, e) {
                    var target = $('[data-change-text-id="' + e + '"]');
                    target.text(text);
                });
            });
        });
    })(),
    CardMaker = function () {
        var card = null;
        var e = $('[data-toggle="card-maker"]');
        e.length && e.each(function (i, element) {
            $(this).attr("id", $(this).attr("id") + "-" + i);
            card = new Card({
                container: $(this),
                form: $("form#form-card-make"),
                layout: $(this).data("layout"),
                frame_front: $(this).data("front"),
                frame_background: $(this).data("background"),
                data: $(this).data("user")
            });
            card.make();
        });

        var e = $('[data-toggle="card-frame"]');
        e.length && e.each(function () {
            if( !$(this).hasClass("card-frame-loaded") ){
                $(this).addClass("card-frame-loaded")
                .on("click", function (event) {
                    event.preventDefault();
                    var selected = $(this).data("text-selected");
                    var select = $(this).data("text-select");
                    var self = this,
                        id = $(this).attr("data-id"),
                        url = $(this).attr("data-link"),
                        container = $("<div>"),
                        title = $(this).attr("data-title"),
                        text = $("<strong>").attr({
                            class: "swal2-content",
                            id: "swal2-content"
                        }).html($(this).attr("data-text")).appendTo(container),
                        containerImage = $("<div>").addClass("row").appendTo(container),
                        confirm = $(this).attr("data-confirm-button-text"),
                        getImage = $(this).attr("data-image");

                    if (getImage) {
                        var allImage = getImage.split(","),
                            setClass = "col-md-6";

                        switch (allImage.length) {
                            case 1:
                                setClass = "col-md-12";
                                break;
                            case 2:
                                setClass = "col-md-6";
                                break;
                            case 3:
                                setClass = "col-md-4";
                                break;
                            case 4:
                                setClass = "col-md-3";
                                break;
                            default:
                                setClass = "col-md-2";
                                break;
                        }

                        $.each(allImage, function (i, img) {
                            var colImage = $("<div>").addClass(setClass + " p-1").appendTo(containerImage),
                                image = $("<img>").attr({
                                    src: img,
                                    width: "100%"
                                }).appendTo(colImage);
                        });
                    }

                    Swal.queue([{
                        title: title,
                        type: "question",
                        html: container,
                        confirmButtonText: confirm,
                        showLoaderOnConfirm: true,
                        preConfirm: () => {
                            return $.ajax({
                                url: url,
                                method: "POST",
                                processData: false,
                                contentType: false,
                                success: response => {
                                    if (response.success) {
                                        e.each(function () {
                                            $(this).removeClass("disabled");
                                           var target = $(this).data("target");
                                            if(target){
                                                $(target).addClass("d-none");
                                            }
                                        });
                                        $(self).addClass("disabled");
                                        var target = $(self).data("target");
                                        if(target){
                                            $(target).removeClass("d-none");
                                        }

                                        text.html(response.message.text);
                                        Swal.insertQueueStep({
                                            title: response.message.title,
                                            type: "success",
                                            html: container,
                                            confirmButtonText: response.message.button.confirm
                                        });

                                        card.set({
                                            frame_front: response.data.front_o,
                                            frame_background: response.data.background_o,
                                            layout: response.data.layout
                                        });
                                        card.update();
                                    }
                                }
                            });
                        }
                    }]);
                });
            }
        });
    };
    CardMaker();
    var CertificateMaker = function () {
        var certificate = null;
        var e = $('[data-toggle="certificate-maker"]');
        e.length && e.each(function (i, element) {
            $(this).attr("id", $(this).attr("id") + "-" + i);
            certificate = new Certificate({
                container: $(this),
                form: $("form#form-card-make"),
                layout: $(this).data("layout"),
                frame_front: $(this).data("front"),
                frame_background: $(this).data("background"),
                data: $(this).data("user")
            });
            certificate.make();
        });

        var e = $('[data-toggle="certificate-frame"]');
        e.length && e.each(function () {
            if(!$(this).hasClass("certificate-frame-loaded")){
                $(this).addClass("certificate-frame-loaded")
                .on("click", function (event) {
                    event.preventDefault();
                    var selected = $(this).data("text-selected");
                    var select = $(this).data("text-select");
                    var self = this,
                        id = $(this).attr("data-id"),
                        url = $(this).attr("data-link"),
                        container = $("<div>"),
                        title = $(this).attr("data-title"),
                        text = $("<strong>").attr({
                            class: "swal2-content",
                            id: "swal2-content"
                        }).html($(this).attr("data-text")).appendTo(container),
                        containerImage = $("<div>").addClass("row").appendTo(container),
                        confirm = $(this).attr("data-confirm-button-text"),
                        getImage = $(this).attr("data-image");

                    if (getImage) {
                        var allImage = getImage.split(","),
                            setClass = "col-md-6";

                        switch (allImage.length) {
                            case 1:
                                setClass = "col-md-12";
                                break;
                            case 2:
                                setClass = "col-md-6";
                                break;
                            case 3:
                                setClass = "col-md-4";
                                break;
                            case 4:
                                setClass = "col-md-3";
                                break;
                            default:
                                setClass = "col-md-2";
                                break;
                        }

                        $.each(allImage, function (i, img) {
                            var colImage = $("<div>").addClass(setClass + " p-1").appendTo(containerImage),
                                image = $("<img>").attr({
                                    src: img,
                                    width: "100%"
                                }).appendTo(colImage);
                        });
                    }

                    Swal.queue([{
                        title: title,
                        type: "question",
                        html: container,
                        confirmButtonText: confirm,
                        showLoaderOnConfirm: true,
                        preConfirm: () => {
                            return $.ajax({
                                url: url,
                                method: "POST",
                                processData: false,
                                contentType: false,
                                success: response => {
                                    if (response.success) {
                                        e.each(function () {
                                            $(this).removeClass("disabled");
                                           var target = $(this).data("target");
                                            if(target){
                                                $(target).addClass("d-none");
                                            }
                                        });
                                        $(self).addClass("disabled");
                                        var target = $(self).data("target");
                                        if(target){
                                            $(target).removeClass("d-none");
                                        }

                                        text.html(response.message.text);
                                        Swal.insertQueueStep({
                                            title: response.message.title,
                                            type: "success",
                                            html: container,
                                            confirmButtonText: response.message.button.confirm
                                        });

                                        certificate.set({
                                            frame_front: response.data.front_o,
                                            frame_background: response.data.background,
                                            layout: response.data.layout
                                        });
                                        certificate.update();
                                    }
                                }
                            });
                        }
                    }]);
                });
            }

        });
    };
    CertificateMaker();
    var Dropdown = (function () {
        var e = $(".dropdown");

        e.length && e.each(function () {
            $(this).on("click.bs.dropdown", function () {
                console.log($(this))
                if ($(this).attr("data-close") == "false") {
                    return $(this).one("hide.bs.dropdown", function () {
                        return false;
                    });
                }
            });
        });
    })(),
    sGFselecionado = function (fonte, variante, json) {
        jQuery(".preview").css("font-family", fonte);
        jQuery(".preview").removeClass("sGFfonte-100 sGFfonte-200 sGFfonte-300 sGFfonte-regular sGFfonte-italic sGFfonte-500 sGFfonte-600 sGFfonte-700 sGFfonte-800 sGFfonte-900 sGFfonte-100italic sGFfonte-200italic sGFfonte-300italic sGFfonte-500italic sGFfonte-600italic sGFfonte-700italic sGFfonte-800italic sGFfonte-900italic");
        jQuery(".preview").addClass("sGFfonte-" + variante);

        console.log("fonte", fonte);
        console.log("variante", variante);
        console.log("json", json);
    },
    FontPicker = (function () {
        var e = $('[data-toggle="font"]');
        e.length && e.each(function () {
            selectGfont({
                key: "AIzaSyDlD2NdRw4MDt-jDoTE_Hz3JqNpl154_qo",
                // Use You-Google-Fonts-API-Key
                containerFonte: "#" + $(this).attr("id"),
                containerVariante: "#selectGFontVariante",
                sort: "popularity",
                onSelectFonte: "sGFselecionado",
                onSelectVariante: "sGFselecionado"
            }).then(function () {}).catch(function (erro) {
                console.error(erro);
            });
        });
    })(),
    ColorPickers = (function () {
        var e = $('[data-toggle="color"]');
        e.length && e.each(function () {
            if (typeof ColorPicker !== "undefined") {
                var colorPickerDefaultCustomAnchor = new ColorPicker.Default("#" + $(this).attr("id"), {
                    color: "#23499E"
                });
            }
        });
    })(),
    Croppie = (function () {
        var e = $('[data-toggle="photo-crop"]');
        e.length && e.each(function (i, p) {
            $(this).children().addClass("d-none");
            var input = $(this).find('input[type="file"]');

            p = $(this).croppie({
                enableExif: true,
                enableOrientation: true,
                viewport: {
                    width: $(this).data("viewport-width") ? $(this).data("viewport-width") : 250,
                    height: $(this).data("viewport-height") ? $(this).data("viewport-height") : 300,
                    type: $(this).data("type") ? $(this).data("type") : "square"
                },
                boundary: {
                    width: "100%",
                    height: "250px"
                },
                update: function (data) {
                    p.croppie("result", {
                        type: "canvas",
                        size: "viewport"
                    }).then(function (photo) {
                        var target = $(p).attr("data-update");
                        $(target + ":last").attr("src", photo);
                    });
                }
            });
            p.croppie("bind", {
                url: $(this).data("src")
            });

            $(this).parents("form").unbind("submit").on("submit", function (event) {
                event.preventDefault();
                var btn = $(this).find('[type="submit"]');
                p.croppie("result", {
                    type: "canvas",
                    size: "viewport"
                }).then(function (photo) {
                    var formData = new FormData(event.target);
                    var loading = $('<div class="loading" style="background-color: rgba(0, 0, 0, 0.4); position: absolute; height: 100%; width: 100%; z-index: 2;"><div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);"><div class="spinner-border spinner-3 text-blue"></div></div></div>');
                    var load = $('<span class="loading"><img src="' + location.origin + '/assets/img/icons/LOOn0JtHNzb.gif"></span>');
                    formData.append(input.attr("name") ? input.attr("name") : "photo", base64toBlob(photo));
                    $.ajax({
                        url: $(event.target).attr("action"),
                        method: "POST",
                        data: formData,
                        processData: false,
                        contentType: false,
                        beforeSend: function (xhr) {
                            if ($(event.target).parents(".modal").length) {
                                $(event.target).parents(".modal").prepend(loading);
                            } else {
                                $(event.target).prepend(loading);
                            }
                            btn.addClass("disabled").attr("type", "button").append(load);
                        },
                        success: function (response) {
                            if (response.success) {
                                loading.remove();
                                btn.removeClass("disabled").attr("type", "submit").find(".loading").remove();
                                var container = $("<div>"),
                                    containerImage = $("<div>").addClass("row").appendTo(container),
                                    colImage = $("<div>").addClass("col-6 offset-3").appendTo(containerImage),
                                    image = $("<img>").attr({
                                        src: response.data,
                                        width: "100%"
                                    }).appendTo(colImage);

                                swal({
                                    title: response.message.title,
                                    type: "success",
                                    html: container,
                                    confirmButtonText: response.message.button.confirm
                                });
                            }
                        },
                        error: function (xhr, type, error) {}
                    });
                });
            });
        });
    })(),
    UploadCroppie = (function () {
        var e = $('[data-toggle="upload-crop"]');
        e.length && e.each(function () {
            $(this).on("change", function (event) {
                var target = $(this).data("target");
                if (window.File && window.FileReader && window.FileList && window.Blob) {
                    var files = event.target.files;
                    var file = files[0];
                    var reader = new FileReader();
                    if (file && file.type.match("image.*")) {
                        var loading = $('<div class="img w-100 h-100"><div class="w-100 h-100 d-flex align-items-center"><div class="spinner spinner-4"></div></div></div>');
                        $(this).after(loading);

                        reader.onload = (function (file) {
                            return function (e) {
                                $(target + ":last").croppie("bind", {
                                    url: e.target.result
                                });
                                loading.remove();

                                var a = $('[data-toggle="select-crop"]');
                                a.each(function () {
                                    $(this).removeClass("disabled").html($(this).data("text-select"));
                                });
                            };
                        })(file);
                        reader.readAsDataURL(file);
                    }
                }
            });
        });
    })(),
    SelectCroppie = (function () {
        var e = $('[data-toggle="select-crop"]');
        e.length && e.each(function () {
            $(this).on("click", function (event) {
                event.preventDefault();
                var image = $(this).data("image");
                var selected = $(this).data("text-selected");
                var select = $(this).data("text-select");
                var target = $(this).data("target");
                $(target + ":last").croppie("bind", {
                    url: image
                });
                e.each(function () {
                    $(this).removeClass("disabled").html(select);
                });
                $(this).addClass("disabled").html(selected + '<li class="fas fa-check"></li>');
            });
        });
    })(),
    QrCode = (function () {
        var e = $('[data-toggle="qrcode"]');
        e.length && e.each(function () {
            var border = 10;
            $(this).html("").qrcode({
                render: "canvas",
                text: $(this).data("text") || location.href,
                width: 100 - border,
                height: 100 - border,
                correctLevel: 1,
                background: "#ffffff",
                foreground: "#000000",
                src: $(this).data("image"),
                imgWidth: 0,
                imgHeight: 0
            });
            $(this).children().css("border-width", border);

            $(this).parents("form").unbind("submit").on("submit", function (event) {
                event.preventDefault();
                var formData = new FormData(event.target);
                var btn = $(this).find('[type="submit"]');
                var loading = $('<div class="loading" style="background-color: rgba(0, 0, 0, 0.4); position: absolute; height: 100%; width: 100%; z-index: 2;"><div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);"><div class="spinner-border spinner-3 text-blue"></div></div></div>');
                var load = $('<span class="loading"><img src="' + location.origin + '/assets/img/icons/LOOn0JtHNzb.gif"></span>');
                $.ajax({
                    url: $(event.target).attr("action"),
                    method: "POST",
                    data: formData,
                    processData: false,
                    contentType: false,
                    beforeSend: function (xhr) {
                        if ($(event.target).parents(".modal").length) {
                            $(event.target).parents(".modal").prepend(loading);
                        } else {
                            $(event.target).prepend(loading);
                        }
                        btn.addClass("disabled").attr("type", "button").append(load);
                    },
                    success: function (response) {
                        if (response.success) {
                            loading.remove();
                            btn.removeClass("disabled").attr("type", "submit").find(".loading").remove();
                            var container = $("<div>");
                            container.addClass("list-group list-group-flush text-left");

                            $.each(response.data, function () {
                                $('<a href="#" class="list-group-item list-group-item-action">\
                                                <div class="row">\
                                                    <div class="avatar avatar-xl rounded">\
                                                        <img  src="' + this.qrcode + '" alt="">\
                                                    </div>\
                                                    <div class="col ml--2">\
                                                        <div class="d-flex justify-content-between align-items-center">\
                                                            <div>\
                                                                <h4 class="mb-0 text-sm">'+ this.name + '</h4>\
                                                            </div>\
                                                        </div>\
                                                        <p class="text-sm mb-0">' + this.study_course_session.name + '\
                                                        </p>\
                                                    </div>\
                                                </div>\
                                            </a>').appendTo(container);
                            });

                            swal({
                                title: response.message.title,
                                type: "success",
                                html: container,
                                confirmButtonText: response.message.button.confirm
                            });
                        }
                    },
                    error: function (xhr, type, error) {}
                });
            });
        });
    })(),
    QrCodeResize = (function () {
        var e = $('[data-toggle="qrcode-size"]');
        e.length && e.each(function () {
            var target = $(this).data("target");
            this.noUiSlider.on("update", (e, a) => {
                var size = parseInt(e[a]);

                $(this).parent().find("#input-slider-value").html('<input type="hidden" value="' + size + '" name="qrcode_size">' + size);
                var border = 10;
                if (size > 100 < 150) {
                    border = 15;
                } else if (size > 150 < 300) {
                    border = 20;
                } else if (size > 300 < 500) {
                    border = 25;
                }
                $(target + ":last").html("").qrcode({
                    render: "canvas",
                    text: $(target + ":last").data("text") || location.href,
                    width: size - border,
                    height: size - border,
                    correctLevel: 1,
                    background: "#ffffff",
                    foreground: "#000000",
                    src: $(target + ":last").data("image"),
                    imgWidth: 0,
                    imgHeight: 0
                });

                $(target + ":last").children().css("border-width", border);
            });
        });
    })(),
    QrCodeReader = (function () {
        var e = $('[data-toggle="modal-qrcode"]'),
            a = $('[data-toggle="qrcode-reader"]'),
            s = new Audio("/../../../assets/sounds/scan.mp3"),
            scanner = null,
            oldData = null;
        e.length && e.each(function () {
            $(this).on("click", function (e) {
                e.preventDefault();
                var modal = $(this).attr("data-target");

                $(modal).modal({
                    show: true,
                    backdrop: "static",
                    keyboard: false
                }).on("hidden.bs.modal", function () {
                    if (scanner) {
                        scanner.stop();
                        a.find("video").remove();
                    }
                });

                a.length && a.each(function () {
                    var self = $(this),
                        divErrr = $("<div>").addClass("text-danger p-5"),
                        cameraError = self.attr("data-camera-error");
                    divErrr.html(cameraError);

                    self.css({
                        width: "100%",
                        height: "100%",
                        margin: "auto",
                        background: "url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADwAAAAwCAYAAABNPhkJAAAACXBIWXMAAAsTAAALEwEAmpwYAAAF62lUWHRYTUw6Y29tLmFkb2JlLnhtcAAAAAAAPD94cGFja2V0IGJlZ2luPSLvu78iIGlkPSJXNU0wTXBDZWhpSHpyZVN6TlRjemtjOWQiPz4gPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iQWRvYmUgWE1QIENvcmUgNS42LWMxNDIgNzkuMTYwOTI0LCAyMDE3LzA3LzEzLTAxOjA2OjM5ICAgICAgICAiPiA8cmRmOlJERiB4bWxuczpyZGY9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkvMDIvMjItcmRmLXN5bnRheC1ucyMiPiA8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0iIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtbG5zOmRjPSJodHRwOi8vcHVybC5vcmcvZGMvZWxlbWVudHMvMS4xLyIgeG1sbnM6cGhvdG9zaG9wPSJodHRwOi8vbnMuYWRvYmUuY29tL3Bob3Rvc2hvcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RFdnQ9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZUV2ZW50IyIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ0MgKFdpbmRvd3MpIiB4bXA6Q3JlYXRlRGF0ZT0iMjAxOC0wNy0yNFQxNToxMDoyNiswNzowMCIgeG1wOk1vZGlmeURhdGU9IjIwMTgtMDktMTJUMTU6NTk6MDkrMDc6MDAiIHhtcDpNZXRhZGF0YURhdGU9IjIwMTgtMDktMTJUMTU6NTk6MDkrMDc6MDAiIGRjOmZvcm1hdD0iaW1hZ2UvcG5nIiBwaG90b3Nob3A6Q29sb3JNb2RlPSIzIiBwaG90b3Nob3A6SUNDUHJvZmlsZT0ic1JHQiBJRUM2MTk2Ni0yLjEiIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6MzA0MjAzYzMtNDVkMy1lMjQzLWIyYjQtZTkxNWQ0ZWZmNzY4IiB4bXBNTTpEb2N1bWVudElEPSJhZG9iZTpkb2NpZDpwaG90b3Nob3A6MDFlYTM1YWUtNThkYS00ZjQ2LWFkNDMtZDEyNTc0ZTAwODY1IiB4bXBNTTpPcmlnaW5hbERvY3VtZW50SUQ9InhtcC5kaWQ6OTlhNzZjZjYtNTJlYy1hNTRiLTljNGUtMmIyNDMzNzdiMjc5Ij4gPHhtcE1NOkhpc3Rvcnk+IDxyZGY6U2VxPiA8cmRmOmxpIHN0RXZ0OmFjdGlvbj0iY3JlYXRlZCIgc3RFdnQ6aW5zdGFuY2VJRD0ieG1wLmlpZDo5OWE3NmNmNi01MmVjLWE1NGItOWM0ZS0yYjI0MzM3N2IyNzkiIHN0RXZ0OndoZW49IjIwMTgtMDctMjRUMTU6MTA6MjYrMDc6MDAiIHN0RXZ0OnNvZnR3YXJlQWdlbnQ9IkFkb2JlIFBob3Rvc2hvcCBDQyAoV2luZG93cykiLz4gPHJkZjpsaSBzdEV2dDphY3Rpb249InNhdmVkIiBzdEV2dDppbnN0YW5jZUlEPSJ4bXAuaWlkOjMwNDIwM2MzLTQ1ZDMtZTI0My1iMmI0LWU5MTVkNGVmZjc2OCIgc3RFdnQ6d2hlbj0iMjAxOC0wOS0xMlQxNTo1OTowOSswNzowMCIgc3RFdnQ6c29mdHdhcmVBZ2VudD0iQWRvYmUgUGhvdG9zaG9wIENDIChXaW5kb3dzKSIgc3RFdnQ6Y2hhbmdlZD0iLyIvPiA8L3JkZjpTZXE+IDwveG1wTU06SGlzdG9yeT4gPC9yZGY6RGVzY3JpcHRpb24+IDwvcmRmOlJERj4gPC94OnhtcG1ldGE+IDw/eHBhY2tldCBlbmQ9InIiPz6DMb7AAAAGuUlEQVRogeXaa6wdVRUH8N9l2nppCxRoa7EKSUWQSOWoVCj4qG/xkaLFSIziF3xFjTKl9RVMUBGDMsT3M9EgaKwE3xQJxtQSKqBhQKJpVaDW0lpaLoUWCnR6/bDmcM+9vffMmbmnNcR/cnLmzKy99/qfvWbttdbeA8PDw/6fMGWyHSRZXiUyA8ejheNwGAbLZ3vwMDYixz+wu874RdqqIz55whNgBhZjEY4SxLZiPR7FY6Xc03AoZuMc8Uc8gNuwTk3yvaDfhGfjbCzEZtyEu/Agqt6dAczCyeLPejP+gl/hP/1SsF+Ep+LtOBO34AvYUrOPYQxhbfk5RpA+Az8rZV6EL5VyH8J9dRXtB+ET8GFswqdxfx/6JP6w74y5NxdLsBcrm3R6yGQ0SrL8LHwSP8Vl+kd2LAbK76L8fvLdTrJ8YH/xLh01XZaSLD9PmPBF2Naok94wG1diPmZigSC+ofy+GR8o0ta+XjprZNJJlr8Lp2I5djXpowYG8WIc3akCTiqvHxKWemAIJ1n+erwEFxRp65Ee1uHJYjveKZavhbhYmPRK4b23GTH1StQinGT58XgHVhZp65E6bSeBPbi+vN4uCBf4Oe47YIFHkuXThAl/s0hbW2uNEiY4YOK1uP2saqamCw+9r7yujToz/DbcU6StdTXaDOD9ZdtEd8KF8Pbf6iJ3K16FJ/BvSLL8ZDy9SFu/60WhnggnWX4UXoaP9yLfgVfiGzXkXyG870TKD+EPY+7twEeTLL+9SFsPVA3Q6zq8DDcXaWuoR/k2XlBTvnabIm1tESHssl7kKwknWT4Dp+C6OoqUmHeQ2vwGp5S6dkUvJr0Ym4u09WQUlWT5PFwu0r6947RpO6CTxnlWhfNwuggyxsMhwuyXi7RSkbbuT7J8c6nrjd0674XwaVgz5t5rxfLUBLvFezcsUsfDxjyfI9LG3wtH14l9IqNaVur01Y5na/FykyGcZPl0HClSvE40icGvxyoRCm4VhOeKKOocLO3od41IM8fDAvzT/rrfhaVJlk/vFiNUzfCJImHfOeZ+nQB8M1bgJ/YP/x4SVY4f4U24Qrwmc0ToOnWM/F4jr8nYvnaKIOVE3D6RMlWEn4+tRdpqWvi6W8zcWAtpE3mi496v8Vf8UrzDt1X0PYpwkbaGkyzfKhzshISrTPM4Ec41wR6812iyp+JrwmTXinx3Scfzu/FuzROS7Ti2m0AV4VmTGPxqowOI9wlH9EHhTU/De/BbkWK28Wd8veGYu4TOE6KK8CAebzDw4/h2x+/XiJkdb6mZhs+IjKiN74v3u8m4g90EJlXx6IL15YeIky9U7S+WG1H2HlHA6zuqCO8RM1AXm4zM0DEij63Cs4WHJWZqY4NxpwmdJ0QV4Z2ixlwXnd53pv2Xl/EwZcxYjzYYd6YoCU+IKsIbxZpYF4cbMeEtVUqU2CUso42jJxLsgtn4VzeBKsJ3YF7dyqAwzbnl9cO4toc2NxghPEvNOLzUcZ7QeUJUEV4vaklH1BkczxC5bRuX6RIMiGirc2laLOrddXCE0HV9N6GuhMuYdEhsf9TFR0oFiGThrSK8fKxDZp9IO98iPDORMCw3UovuFc/DUFWtrZds6RZRpbyppgKLxPq6ovx9L84Vu4gLBbG/4U9G17JWiDJOXby01LUrelmH12F+kuVNnNeFgnTnODl+iB8IBTvJpvhs3UFK3eaXunZFJeEibe3GnXhDXUVKXCSc1uldZF4oMqbLNdscOAt3lrp2Ra+dX4tLkiz/RZG2Hmyg1FK8Dn8U+fC9IsU8VjiobhWOiTAFkiyfJXYYP9VzoyoUaWtHkuVrcb7YrtxU0WQ8DIrMaEmDtuOhrcP5WFukrR29NKozU9fgiiTLFxVp64Yky88WMzReTetAYooIZq4RjnGB0aWerqi1e5hk+XPE9ujKdlHvIOwtTYQ5Yn3/fJG2/t5ro1rZUtnxKlycZHnXNOwAY1DsMa2qQ5YG6WGRtlYLx3Np6TAONg7HJaUOq+s2bpQPF2nrKhEqflmsfwcLzxLVkDtwVZMOGhcAirR1JX6ML4o9pAONV5djXS1OBDRC4yMPbSRZfgIuEOXY7+rjEaMS80Tt65kiMNnQ+fB/cTBtgzjFcy4+J7Y0rxN/wGQwH28Uhfo1uFQflsB+ndPaK96p1SLz+YTYv10nalNDejuYdqRILM4QM5rjYyLb6gv6fRJvB75n5OjhmeJwWfvo4TZR2WiXgKaKkHKuMN1Dyz5uxVc8BY4etrFbbGrdaPTh0ucaSdQZ2cbZKArztQ+X1sWkndZTDf8FxObDlmFi/ikAAAAASUVORK5CYII=) no-repeat center"
                    });

                    var height = self.height(),
                        width = self.width();
                    if (!height && !width) {
                        height = "100%";
                        width = "100%";
                    }

                    self.append('<video id="preview" width="' + width + '" height="' + height + '"></video>');

                    scanner = new Instascan.Scanner({
                        video: document.getElementById("preview")
                    });
                    self.find(".please_wait").hide();
                    scanner.addListener("scan", qrcodeSuccess);
                    Instascan.Camera.getCameras().then(function (cameras) {
                        if (cameras.length > 0) {
                            scanner.start(cameras[0]);
                        } else {
                            //console.log('No cameras found.');
                            self.html(cameraError ? divErrr : divErrr.html("No cameras found.")).css({
                                backgroundColor: "rgba(255, 255, 255, 0.8)",
                                backgroundBlendMode: "lighten"
                            });
                        }
                    }).catch(function (e) {
                        self.html(cameraError ? divErrr : divErrr.html(e)).css({
                            backgroundColor: "rgba(255, 255, 255, 0.8)",
                            backgroundBlendMode: "lighten"
                        });
                    });

                    function qrcodeSuccess(callback) {
                        self.find(".please_wait").show();
                        $.ajax({
                            url: self.attr("data-url"),
                            method: "POST",
                            data: {
                                code: callback
                            },
                            success: function (response) {
                                self.find(".please_wait").hide();
                                if (response.success) {
                                    $.each(response.data, function () {
                                        var template = '<div data-notify="container" data-id="' + this.id + '" class="border-0 list-group-item list-group-item-action col-xs-11 col-sm-3 alert bg-{0}" role="alert">\
                                                                        <button type="button" aria-hidden="true" class="close" data-notify="dismiss">×</button>\
                                                                        <div class="row align-items-left px-3">\
                                                                            <div class="avatar avatar-xl rounded">\
                                                                                <img  src="' + this.photo + '" alt="">\
                                                                            </div>\
                                                                            <div class="col ml--2">\
                                                                                <div class="d-flex justify-content-between align-items-center">\
                                                                                    <div>\
                                                                                        <h4 class="mb-0 text-sm">\
                                                                                        ' + this.fullname + '\n\
                                                                                        </h4>\
                                                                                        <h4 class="mb-0 text-sm">\
                                                                                        ' + this.study_course + '\n\
                                                                                        </h4>\
                                                                                    </div>\
                                                                                </div>\
                                                                                <p class="text-sm mb-0">\
                                                                                ' + this.study_generation + '\n\
                                                                                </p>\
                                                                                <p class="text-sm mb-0">\
                                                                                    ' + this.study_academic_year + "\n\
                                                                                    " + this.study_semester + "\n\
                                                                                    " + this.study_session + '\n\
                                                                                </p>\
                                                                                <p class="text-sm mb-0">\
                                                                                    ' + response.message + '\n\
                                                                                </p>\
                                                                            </div>\
                                                                        </div>\
                                                                <div class="progress" data-notify="progressbar">\
                                                                <div class="progress-bar progress-bar-{0}" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" style="width: 0%;"></div>\
                                                            </div>\
                                                            <a href="{3}" target="{4}" data-notify="url"></a>\
                                                         </div>';

                                        s.play();
                                        if (response.sound) {
                                            new Audio(response.sound).play();
                                        }

                                        $.notify({}, {
                                            type: "success",
                                            timer: 1500,
                                            template: template
                                        });
                                        Attendances(this, Object.values(this.date).pop().date);
                                    });
                                } else {
                                    $.each(response.data, function () {
                                        var template = '<div data-notify="container" data-id="' + this.id + '" class="border-0 list-group-item list-group-item-action col-xs-11 col-sm-3 alert bg-{0}" role="alert">\
                                                                    <button type="button" aria-hidden="true" class="close" data-notify="dismiss">×</button>\
                                                                    <div class="row align-items-left px-3">\
                                                                        <div class="avatar avatar-xl rounded">\
                                                                            <img  src="' + this.photo + '" alt="">\
                                                                        </div>\
                                                                        <div class="col ml--2">\
                                                                            <div class="d-flex justify-content-between align-items-center">\
                                                                                <div>\
                                                                                    <h4 class="mb-0 text-sm">\
                                                                                    ' + this.name + '\n\
                                                                                    </h4>\
                                                                                    <h4 class="mb-0 text-sm">\
                                                                                    ' + this.study_course.name + '\n\
                                                                                    </h4>\
                                                                                </div>\
                                                                            </div>\
                                                                            <p class="text-sm mb-0">\
                                                                            ' + this.study_generation.name + '\n\
                                                                            </p>\
                                                                            <p class="text-sm mb-0">\
                                                                                ' + this.study_academic_year.name + "\n\
                                                                                " + this.study_semester.name + "\n\
                                                                                " + this.study_session.name + '\n\
                                                                            </p>\
                                                                            <p class="text-sm mb-0">\
                                                                                ' + response.message + '\n\
                                                                            </p>\
                                                                        </div>\
                                                                    </div>\
                                                            <div class="progress" data-notify="progressbar">\
                                                            <div class="progress-bar progress-bar-{0}" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" style="width: 0%;"></div>\
                                                        </div>\
                                                        <a href="{3}" target="{4}" data-notify="url"></a>\
                                                     </div>';
                                        if (response.sound) {
                                            new Audio(response.sound).play();
                                        }
                                        $.notify({}, {
                                            type: "warning",
                                            timer: 1500,
                                            template: template
                                        });
                                    });
                                }
                            }
                        });
                    }

                    function qrcodeError(callback) {}

                    function videoError(callback) {
                        console.log(callback);
                    }

                    function localStream(callback) {
                        stream = callback;
                    }
                });
            });
        });
    })(),
    TableMergeCell = function (table) {
        var merge = [];

        $(table.element).find(".merge").each(function () {
            if ($.inArray($.trim($(this).attr("class")), merge) == -1) {
                merge.push($.trim($(this).attr("class")));
            }
        });
        $.each(merge, function () {
            var cells = table.element.querySelectorAll('[class="' + this + '"]');

            table.merge(cells, function (colspan, rowspan, kept, removed) {
                var setText = $(kept).text();
                for (var i = 0; i < removed.length; i++) {
                    if ($.trim($(removed[i]).text()) !== $.trim(setText)) {
                        setText += " " + $(removed[i]).text();
                    }
                }

                var setTitle = $(kept).attr("data-original-title");
                for (var i = 0; i < removed.length; i++) {
                    if ($.trim($(removed[i]).attr("data-original-title")) !== $.trim(setTitle)) {
                        setTitle += " " + $(removed[i]).attr("data-original-title");
                    }
                }

                var container = $("<div>").addClass("rotate").css({
                        writingMode: "vertical-rl",
                        textOrientation: "mixed",
                        transform: "rotate(-180deg)",
                        margin: "auto"
                    }),
                    p = $("<p>").css({
                        "font-size": "0.8125rem",
                        margin: colspan == 1 ? "0rem" : "1rem"
                    }).html(setText).appendTo(container);
                $(kept).attr("data-original-title", setTitle).html(container);
                $(kept).removeClass("merge");
            });

        });
    },
    Tables = (function () {
        var e = $("table");
        e.length && e.each(function () {
            if (typeof Table !== "undefined") {
                var table = new Table(this);
                TableMergeCell(table);
            }
        });
    })(),
    Attendances = function (Alldata, editDate) {
        var self = $('[data-id="' + Alldata.id + '"][data-date="' + editDate + '"]'),
            dates = Alldata.date,
            atten = dates[editDate]["attendance"],
            span = $("<span>").attr({
                "data-toggle": "tooltip",
                rel: "tooltip",
                "data-placement": "left",
                "data-trigger": "hover",
                "data-original-title": atten["name"]
            }).html(atten["credit_absent"]);

        self.attr("data-key", atten["id"]).html(span);
        self.parents("tr").find("td[data-total-permission]").html(Alldata.total_p);
        self.parents("tr").find("td[data-total-absent]").html(Alldata.total_a);
        self.parents("tr").find("td[data-total-all]").html(Alldata.total_all);

        if (Alldata.total_all < 5) {
            self.parents("tr").removeAttr("class");
        } else if (Alldata.total_all >= 5) {
            self.parents("tr").addClass("bg-gray text-white");
        }
    },
    TablesPopoverAttendances = (function () {
        var e = $("[data-toggle=attendance]"),
            self = e;
        e.length && e.popover({
            html: true,
            trigger: "click",
            placement: "right",
            content: $("#form-edit").children()
        }) && e.each(function () {
            $(this).on("click", function () {
                self = $(this);
                $("#form-edit-attendance").find("select#attendance_type").val($(this).attr("data-key")).trigger("change");
                $($(this).data("bs.popover").getTipElement()).css("z-index", 1).find(".popover-body").css("width", "200px");
            });
        });

        $("select#attendance_type").on("select2:select", function (e) {
            var a = $(e.params.data.element).attr("data-absent"),
                formData = new FormData();

            formData.append("date", self.attr("data-date"));
            //formData.append("id", self.attr("data-id"));
            formData.append("absent", e.params.data.id);

            $.ajax({
                url: self.attr("data-url"),
                method: "POST",
                data: formData,
                processData: false,
                contentType: false,
                beforeSend: xhr => {
                    var loading = '<div class="spinner spinner-1 text-blue"></div>';
                    self.html(loading);
                    self.popover("hide");
                },
                success: function (response) {
                    if (response.success) {
                        $.each(response.data, function () {
                            Attendances(this, self.attr("data-date"));
                        });
                        self.html(a);
                    }
                }
            });
        });
    })(),
    TablesPopoverScore = (function () {
        var e = $("[data-toggle=score]"),
            self = e;
        e.length && e.each(function () {
            $(this).unbind().on("click", function () {
                self = $(this);
                var val = parseFloat($(self).text());
                if (val) {
                    $("#form-edit-score").find("input#marks").val(val);
                } else {
                    $("#form-edit-score").find("input#marks").val(0);
                }

                var url = $(this).attr("data-url");
                var id = $(this).attr("data-id");
                var subject = $(this).attr("data-subject-id");

                var input_id = $("<input>").attr({
                    type: "hidden",
                    name: "id"
                }).val(id);

                var input_sub = $("<input>").attr({
                    type: "hidden",
                    name: "subject"
                }).val(subject);

                if (id) {
                    if ($("#form-edit-score").find('[name="id"]').length) {
                        $("#form-edit-score").find('[name="id"]').val(id);
                    } else {
                        $("#form-edit-score").prepend(input_id);
                    }
                } else {
                    $("#form-edit-score").find('[name="id"]').remove();
                }

                if (subject) {
                    if ($("#form-edit-score").find('[name="subject"]').length) {
                        $("#form-edit-score").find('[name="subject"]').val(subject);
                    } else {
                        $("#form-edit-score").prepend(input_sub);
                    }
                } else {
                    $("#form-edit-score").find('[name="subject"]').remove();
                }

                $("#form-edit-score").attr("action", url);

                $(self.data("bs.popover").getTipElement()).css("z-index", 1).find(".popover-body").css("width", "200px");

                $("#form-edit-score").find("#close").on("click", function (event) {
                    event.preventDefault();
                    self.popover("hide");
                });
            }).popover({
                html: true,
                trigger: "click",
                placement: "right",
                content: $("#edit-score").children()
            });
        });

        $("#form-edit-score").on("submit", function (event) {
            var mark = $(this).find('[name="marks"]').val();
            event.preventDefault();
            $.ajax({
                url: $(this).attr("action"),
                method: "POST",
                data: new FormData(event.target),
                processData: false,
                contentType: false,
                beforeSend: xhr => {
                    var loading = '<div class="spinner spinner-1 text-blue"></div>';
                    self.html(loading);
                    self.popover("hide");
                },
                success: function (response) {
                    if (response.success) {
                        self.parents("tr").find('[class^="total_marks"]').html(mark);

                        $.each(response.data, function () {
                            self.parents("tr").find('[class^="total_marks"]').html(this.total_marks);
                            self.parents("tr").find('[class^="average"]').html(this.average);
                            self.parents("tr").find('[class^="grade"]').html(this.grade);
                            self.html("<span>" + $(event.target).find("input#marks").val() + "</span>");
                        });
                    }
                }
            });
        });
    })(),
    TablesPopover = (function () {
        $(document).on("click", function (e) {
            var $popover, $target = $(e.target);

            //do nothing if there was a click on popover content
            if ($target.hasClass("popover") || $target.closest(".popover").length) {
                return;
            }

            $('[data-toggle="attendance"]').each(function () {
                $popover = $(this);

                if (!$popover.is(e.target) && $popover.has(e.target).length === 0 && $(".popover").has(e.target).length === 0) {
                    $popover.popover("hide");
                } else {
                    //fixes issue described above
                    $popover.popover("toggle");
                }
            });
        });
    })(),
    TableChecked = function () {
        var e = $('[data-toggle="table-checked"]');
        e.length && e.each(function () {
            $(this).unbind("change").on("change", function () {
                var checked = $(this).prop("checked"),
                    dataChecked = $(this).data("checked"),
                    dataCheckedControls = $(this).data("checked-controls"),
                    dataCheckedShowControls = $(this).data("checked-show-controls");
                if (dataCheckedControls) {
                    $('[data-checked="' + dataCheckedControls + '"]').each(function () {
                        $(this).prop("checked", checked);
                        if (checked) {
                            $.each(dataCheckedShowControls, function () {
                                $('[data-checked-show="' + this + '"]').removeClass("disabled");
                            });
                        } else {
                            $.each(dataCheckedShowControls, function () {
                                $('[data-checked-show="' + this + '"]').removeClass("disabled").addClass("disabled");
                            });
                        }
                    });
                } else {
                    var allchecked = [],
                        a = $('[data-checked="' + dataChecked + '"]');
                    a.length && a.each(function () {
                        allchecked.push($(this).prop("checked"));
                    });
                    if ($.inArray(false, allchecked) != -1) {
                        var b = $('[data-checked-controls="' + dataChecked + '"]');
                        b.length && b.each(function () {
                            $(this).prop("checked", false);
                        });
                        if ($.inArray(true, allchecked) != -1) {
                            $.each(dataCheckedShowControls, function () {
                                $('[data-checked-show="' + this + '"]').removeClass("disabled");
                            });
                        } else {
                            $.each(dataCheckedShowControls, function () {
                                $('[data-checked-show="' + this + '"]').removeClass("disabled").addClass("disabled");
                            });
                        }
                    } else {
                        var b = $('[data-checked-controls="' + dataChecked + '"]');
                        b.length && b.each(function () {
                            $(this).prop("checked", true);
                        });
                        if ($.inArray(true, allchecked) != -1) {
                            $.each(dataCheckedShowControls, function () {
                                $('[data-checked-show="' + this + '"]').removeClass("disabled");
                            });
                        } else {
                            $.each(dataCheckedShowControls, function () {
                                $('[data-checked-show="' + this + '"]').removeClass("disabled").addClass("disabled");
                            });
                        }
                    }
                }
            });
        });
    };
    TableChecked();

    var TableCheckedShow = function () {
        var e = $("[data-checked-show]");
        e.length && e.each(function () {
            if(! $(this).hasClass("data-checked-show-loaded")){
                $(this).addClass("data-checked-show-loaded")
                .on("click", function (event) {
                    event.preventDefault();
                    var url = $(this).data("href"),
                        id = "";
                    if (url) {
                        $("[data-checked-show-controls][value]:checked").each(function (i) {
                            if ($(this).val()) {
                                $(this).parents('tr[data-id="' + $(this).val() + '"]').attr("data-sweet-alert-id", $(this).val());
                                if ($("[data-checked-show-controls][value]:checked").length == i + 1) {
                                    id += $(this).val();
                                } else {
                                    id += $(this).val() + ",";
                                }
                            }
                        });
                        url = url + "/" + id;
                        $(this).attr("href", url);
                        $(this).attr("data-sweet-alert-controls-id", id);
                    } else {
                        url = $(this).attr("href");
                    }

                    var target = $(this).data("target");
                    if (target) {
                        $(target).modal();
                        var ajaxModal = new AjaxFormModal();
                        ajaxModal.set({
                            element: $(this),
                            modalContainer: $(target),
                            url: url,
                            method: "GET",
                            onCompleted: (xhr, type, modalBody) => {
                                if (type == "success") {
                                    modalBody.show();
                                }
                            }
                        });
                        ajaxModal.load();
                    }
                });
            }

        });
    };
    TableCheckedShow();

    var ListGroup = (function () {
        var e = $('[data-toggle="list-group"]');
        e.length && e.each(function () {
            var ajaxLoad = null;
            $(this).unbind("click").on("click", function (event) {
                event.preventDefault();
                var self = this,
                    url = $(self).attr("href"),
                    load = $('<span class="loading ml-2"><img src="' + location.origin + '/assets/img/icons/LOOn0JtHNzb.gif"></span>');
                    var loading = $('<div class="loading" style="background-color: rgba(0, 0, 0, 0.4); position: absolute; height: 100%; width: 100%; z-index: 2;"><div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);"><div class="spinner-border spinner-3 text-blue"></div></div></div>');
                if (url) {
                    if (ajaxLoad) {
                        ajaxLoad.abort();
                    }
                    ajaxLoad = $.ajax({
                        url: url,
                        method: "GET",
                        processData: true,
                        contentType: "text/html",
                        beforeSend: function (xhr) {
                            $(self).find(".title").append(load);
                            $(self).parents().find("[data-list-group]").prepend(loading);
                        },
                        success: function (response) {
                            load.remove();
                            loading.remove();
                            if (response) {
                                var newDocument = new DOMParser().parseFromString(response, "text/html"),
                                    newModal = $(newDocument).find("div.modal"),
                                    newModalHeader = newModal.find("div.modal-header"),
                                    newModalBody = newModal.find("div.modal-body"),
                                    newModalFooter = newModal.find("div.modal-footer"),
                                    newModalForm = newModal.find("form"),
                                    newModalDataListGroup = newModal.find("[data-list-group]");

                                var oldModal = $("div.modal"),
                                    oldModalHeader = oldModal.find("div.modal-header"),
                                    oldModalBody = oldModal.find("div.modal-body"),
                                    oldModalFooter = oldModal.find("div.modal-footer"),
                                    oldModalForm = oldModal.find("form"),
                                    oldModalDataListGroup = oldModal.find("[data-list-group]");
                                oldModalHeader.html(newModalHeader.html());
                                oldModalFooter.html(newModalFooter.html());
                                oldModalDataListGroup.html(newModalDataListGroup.html());

                                oldModalForm.attr({
                                    role: newModalForm.attr("role"),
                                    method: newModalForm.attr("method"),
                                    class: newModalForm.attr("class"),
                                    id: newModalForm.attr("id"),
                                    enctype: newModalForm.attr("enctype"),
                                    "data-validate": newModalForm.attr("data-validate")
                                });

                                if (oldModalForm.attr("nochangeaction") == undefined) {
                                    oldModalForm.attr({
                                        action: newModalForm.attr("action")
                                    });
                                } else if (oldModalForm.attr("nochangeaction") !== "true") {
                                    oldModalForm.attr({
                                        action: newModalForm.attr("action")
                                    });
                                }

                                var oldForm = $(".card-wrapper>form"),
                                    oldDataListGroup = oldForm.find("[data-list-group]");

                                oldForm.attr({
                                    role: newModalForm.attr("role"),
                                    method: newModalForm.attr("method"),
                                    class: newModalForm.attr("class"),
                                    id: newModalForm.attr("id"),
                                    enctype: newModalForm.attr("enctype"),
                                    "data-validate": newModalForm.attr("data-validate")
                                });
                                if (oldForm.attr("nochangeaction") == undefined) {
                                    oldForm.attr({
                                        action: newModalForm.attr("action")
                                    });
                                } else if (oldForm.attr("nochangeaction") !== "true") {
                                    oldForm.attr({
                                        action: newModalForm.attr("action")
                                    });
                                }
                                oldDataListGroup.html(newModalDataListGroup.html());

                                e.each(function () {
                                    $(this).removeClass("active");
                                });
                                $(self).addClass("active");
                                $.getScript(location.origin + "/assets/js/argon.min.js");
                            }
                        }
                    });
                }
            });
        });
    })(),
    sweetAlert = function () {
        var e = $('[data-toggle="sweet-alert"]'),
            ajaxDelete = null;
            e.length && e.each(function(){
                if(!$(this).hasClass("sweet-alert-loaded")){
                    $(this).addClass("sweet-alert-loaded").on("click", function (event) {
                        event.preventDefault();
                        var self = this,
                            url = $(this).attr("href"),
                            id = $(this).attr("data-sweet-alert-controls-id");

                        switch ($(this).data("sweet-alert")) {
                            case "confirm":
                                if (ajaxDelete) {
                                    ajaxDelete.abort();
                                }
                                ajaxDelete = $.get(url).done(function (data) {

                                    if (data.success) {
                                        swal({
                                            title: data.message.title,
                                            html: data.message.text.replace(/\n/g, "<br>"),
                                            type: "warning",
                                            showCancelButton: !0,
                                            buttonsStyling: !1,
                                            confirmButtonClass: "btn btn-danger",
                                            confirmButtonText: data.message.button.confirm,
                                            cancelButtonClass: "btn btn-secondary",
                                            cancelButtonText: data.message.button.cancel
                                        }).then(e => {
                                            if (e.value) {
                                                var formData = new FormData();
                                                $.ajax({
                                                    url: url,
                                                    method: "POST",
                                                    data: formData,
                                                    processData: false,
                                                    contentType: false,
                                                    beforeSend: function () {
                                                        Swal({
                                                            showCloseButton: false,
                                                            allowOutsideClick: false,
                                                            onBeforeOpen: () => {
                                                                Swal.showLoading();
                                                            },
                                                            onClose: () => {
                                                                mainContent.stop();
                                                            }
                                                        });
                                                    },
                                                    success: function (data) {
                                                        if (data.success) {
                                                            if (id) {
                                                                $.each(id.split(","), function (i) {
                                                                    if (id.split(",").length == i + 1) {
                                                                        var tbody = $('[data-sweet-alert-id="' + this + '"]').parents("tbody.list"),
                                                                            table = tbody.parent(),
                                                                            url = null;
                                                                        if (table.length) {
                                                                            $('[data-sweet-alert-id="' + this + '"]').remove();
                                                                            url = table.data("url");
                                                                            if (table.find("tbody>tr").length == 0 && url) {
                                                                                mainContentTable(url, table);
                                                                            }
                                                                        }
                                                                    } else {
                                                                        $('[data-sweet-alert-id="' + this + '"]').remove();
                                                                    }
                                                                });
                                                            }

                                                            if($('[data-toggle="datatable-ajax"]').length){
                                                                $('[data-toggle="datatable-ajax"]').each(function () {
                                                                    var t = $(this).DataTable();
                                                                        t.ajax.reload();
                                                                });
                                                            }

                                                            swal({
                                                                title: data.message.title,
                                                                text: data.message.text,
                                                                type: "success",
                                                                buttonsStyling: !1,
                                                                confirmButtonClass: "btn btn-primary",
                                                                confirmButtonText: data.message.button.confirm
                                                            });
                                                        }else{
                                                            swal({
                                                                title: data.message.title,
                                                                html: data.message.text,
                                                                type: "warning",
                                                                showCancelButton: !0,
                                                                buttonsStyling: !1,
                                                                confirmButtonClass: "btn btn-primary",
                                                                confirmButtonText: data.message.button.confirm,
                                                                cancelButtonClass: "btn btn-secondary",
                                                                cancelButtonText: data.message.button.cancel
                                                            });
                                                        }
                                                    },
                                                    error: function (erorr) {}
                                                });
                                            }
                                        });
                                    } else {

                                        swal({
                                            title: data.message.title,
                                            html: data.message.text,
                                            type: "warning",
                                            showCancelButton: !0,
                                            buttonsStyling: !1,
                                            confirmButtonClass: "btn btn-primary",
                                            confirmButtonText: data.message.button.confirm,
                                            cancelButtonClass: "btn btn-secondary",
                                            cancelButtonText: data.message.button.cancel
                                        });
                                    }
                                });
                                break;
                        }
                    });
                }
            });

    }

    sweetAlert();

    var Search = (function () {
        var ajaxSearch = null;
        var e = $('[data-toggle="search"]');
        e.length && e.each(function () {
            $(this).unbind().on("input", function () {
                if ($(this).val()) {
                    $(this).parent().find('[data-toggle="clear-input"] i').attr("class", "fas fa-times-circle");
                } else {
                    $(this).parent().find('[data-toggle="clear-input"] i').attr("class", "fas fa-search");
                }
                $(this).parents("form").unbind().on("submit", function (e) {
                    e.preventDefault();

                    var oldTable = $("div.main-content").find("table:first"),
                        url = $(this).attr("action"),
                        search = JSON.stringify($(this).serializeArray().reduce(function (obj, item) {
                            obj[item.name] = item.value;
                            return obj;
                        }, {})).replace(/"/g, "").replace(/:/g, "=").replace(/,/g, "&").replace(/{/g, "").replace(/}/g, ""),
                        urlhelper = new UrlHelper();
                    urlhelper.set(null, url + "?" + search);

                    if (ajaxSearch) {
                        ajaxSearch.abort();
                    }

                    ajaxSearch = $.ajax({
                        url: url + "?" + search,
                        method: "GET",
                        data: new FormData(e.target),
                        processData: false,
                        contentType: false,
                        beforeSend: function (xhr) {
                            var loading = '<div class="loading" style="background-color: rgba(0, 0, 0, 0.4); position: absolute; height: 100%; width: 100%; z-index: 2;"><div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);"><div class="spinner spinner-3 text-blue"></div></div></div>';
                            oldTable.parent().css({
                                overflow: "hidden",
                                position: "relative"
                            }).find(".loading").remove();
                            oldTable.before(loading);
                        },
                        success: function (response) {
                            if (response) {
                                var newDocument = new DOMParser().parseFromString(response, "text/html"),
                                    newMaincontent = $(newDocument).find("div.main-content"),
                                    newTable = newMaincontent.find("table:first");

                                oldTable.parent().parent().parent().html(newTable.parent().parent().parent().html());
                                $.getScript(location.origin + "/assets/js/argon.min.js");
                            }
                        }
                    });
                }).submit();
            });
        });
    })(),
    Paginations = (function () {
        $(function () {
            var e = $(".pagination");
            e.length && e.each(function () {

                var self = $(this);
                if(self.hasClass("loaded")){
                    return false;
                }

                self.addClass("loaded").pagination({
                    items: self.data("total-items"),
                    itemsOnPage: self.data("per-pages"),
                    edges: 1,
                    displayedPages: 3,
                    useStartEdge: false,
                    selectOnClick: false,
                    ellipsePageSet: false,
                    ellipseText: '<i class="far fa-ellipsis-h"></i>',
                    currentPage: self.data("current-page"),
                    hrefTextPrefix: (self.data("search-page") ? self.data("url") + self.data("search-page").replace("page=" + self.data("current-page"), "") + "&page=" : self.data("url") + "?page=").replace(/&&/g, "&"),
                    prevText: '<i class="fas fa-angle-left"></i>',
                    nextText: '<i class="fas fa-angle-right"></i>',
                    onPageClick: function (pageNumber, event) {
                        event.preventDefault();
                        var oldTable = $("div.main-content").find(self.data("table")),
                            url = $(event.currentTarget).attr("href");

                        if (oldTable.length && url) {
                            if(typeof MainContent == "function"){
                            var mainContent = new MainContent();
                            mainContent.set({
                                url: url,
                                onBeforeSend: function (xhr) {
                                    var loading = '<div class="loading" style="background-color: rgba(0, 0, 0, 0.4); position: absolute; height: 100%; width: 100%; z-index: 2;"><div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);"><div class="spinner spinner-3 text-blue"></div></div></div>';
                                    oldTable.parent().css({
                                        overflow: "hidden",
                                        position: "relative"
                                    }).find(".loading").remove();
                                    oldTable.before(loading);
                                },
                                onSuccess: function (response, newDocument) {
                                    if (response) {
                                        var newMaincontent = $(newDocument).find("div.main-content"),
                                            newTable = newMaincontent.find(self.data("table"));
                                        oldTable.parent().parent().parent().html(newTable.parent().parent().parent().html());
                                        $.getScript(location.origin + "/assets/js/argon.min.js");
                                    }
                                }
                            });
                            mainContent.load();
                        }
                        }
                    },
                    onInit: function () {
                        if (this.items == 0) {
                            $(".active.page-item").remove();
                        }
                    }
                });
            });
        });
    })(),
    ClearInput = (function () {
        var e = $('[data-toggle="clear-input"]');
        e.length && e.each(function () {
            $(this).on("click", function (event) {
                event.preventDefault();

                $(this).parent().find("input").val("").trigger("input");
            });
        });
    })(),
    TimePicker = (function () {
        var e = $('[data-toggle="time-picker"]');
        e.length && e.each(function (i) {
            var div = $("<div>").addClass("container-" + $(this).attr("name") + "-" + i).css({
                position: "inherit",
                "z-index": "1"
            });
            $(this).addClass("d-none").after(div);
            var options = {
                format: "H:mm:ss",
                container: '[class="' + div.attr("class") + '"]',
                controls: true,
                headers: true,
                inline: true
            };
            var picker = new Picker(this, $.extend(options, Picker.languages[$("html").attr("lang")]));
        });
    })(),
    rgb2hex = function (rgb) {
        if (rgb.search("rgb") == -1) {
            return rgb;
        } else if (rgb == "rgba(0, 0, 0, 0)") {
            return "FFFFFFFF";
        } else {
            rgb = rgb.match(/^rgba?\((\d+),\s*(\d+),\s*(\d+)(?:,\s*(\d+))?\)$/);

            function hex(x) {
                return ("0" + parseInt(x).toString(16)).slice(-2);
            }
            return hex(rgb[1]) + hex(rgb[2]) + hex(rgb[3]).toUpperCase();
        }
    },
    TablesToExcel = (function () {
        var e = $('[data-toggle="table-to-excel"]');
        e.length && e.each(function () {
            $(this).on("click", function (event) {
                event.preventDefault();
                var tables = $(this).data("table-id");
                var tbl = [];
                if (tables)
                    var wb = TableToExcel.initWorkBook();

                $.each(tables.split(","), function (i) {
                    if ($("#" + this).length) {
                        $.each($("#" + this).find("th,tr,td"), function () {
                            var newAttr = {
                                "data-f-sz": $(this).find(".header").length ? 12 : 10,
                                //$(this).css("font-size").replace(/[^0-9]/g,''),
                                "data-a-wrap": $(this).find(".header").length ? true : false,
                                "data-color": rgb2hex($(this).css("color")),
                                "data-fill-color": rgb2hex($(this).css("background-color")),
                                "data-f-name": "Khmer OS Battambang",
                                "data-b-a-s": "thin",
                                border: 1,
                                "data-t": Number($(this).text()) ? "n" : "s",
                                "data-a-text-rotation": $(this).hasClass("merge") ? "90" : "0",
                                "data-a-h": $(this).hasClass("name") ? "" : "center",
                                "data-a-v": $(this).hasClass("name") ? "" : "middle"
                            };
                            $(this).attr(newAttr);
                        });

                        TableToExcel.tableToSheet(wb, document.getElementById(this), {
                            name: $("#" + this).attr("data-name") + ".xlsx",
                            sheet: {
                                name: "Sheet " + (i + 1)
                            }
                        });
                    }
                });
                if (wb) {
                    var name = $("table:first thead h4").text().trim().replace(/(\r\n|\n|\r|\s+)/g, " ");
                    TableToExcel.save(wb, name ? name + ".xlsx" : "name.xlsx");
                }
            });
        });
    })(),
    TablesToPrint = (function () {
        var e = $('[data-toggle="table-to-print"]');
        e.length && e.each(function () {
            $(this).on("click", function (event) {
                event.preventDefault();
                var target = $(this).attr("data-target");
                if ($(target).length) {
                    // $.each($(target).find('th,tr,td'),function(){
                    //     var newCss = {
                    //         "font-size" : $(this).css("font-size").replace(/[^0-9]/g,''),
                    //         "color" : "#"+rgb2hex($(this).css("color")),
                    //         "background-color" : "#"+rgb2hex($(this).css("background-color")),
                    //         "font-family" : "Khmer OS Battambang",
                    //         "border" : $(this).css("border"),
                    //         "text-align" : $(this).css("text-align"),
                    //         //"vertical-align" : $(this).css("vertical-align"),
                    //         //"transform" : $(this).hasClass("merge")? "rotate(-180deg)" : "inherit",
                    //     };
                    //     $(this).css(newCss);
                    //  });
                    $(target).printThis({
                        importCSS: false,
                        importStyle: true,
                        loadCSS: [location.origin + "/assets/css/paper.css"]
                    });
                }
            });
        });
    })(),
    TableColor = (function () {
        var e = $('[data-toggle="table-toggle-color"]');
        e.length && e.each(function () {
            $(this).unbind().on("change", function (event) {
                var tables = $(this).data("table-id");
                if ($(this).is(":checked")) {
                    if (tables) {
                        $.each(tables.split(","), function (i) {
                            if ($("#" + this).length) {
                                $("#" + this).addClass("black_n_white");
                            }
                        });
                    }
                } else {
                    if (tables) {
                        $.each(tables.split(","), function (i) {
                            if ($("#" + this).length) {
                                $("#" + this).removeClass("black_n_white");
                            }
                        });
                    }
                }
            });
        });
    })(),
    TableOption = (function () {
        var e = $('[data-toggle="table-option"]');
        e.length && e.each(function () {
            $(this).unbind().on("change", function (event) {
                if ($(this).is(":checked")) {
                    $(this).parents("table").removeClass("d-print-none");
                } else {
                    $(this).parents("table").addClass("d-print-none");
                }
            });
        });
    })(),
    ContentReFresh = (function () {
        var e = $('[data-toggle="cotent-refresh"]');
        e.length && e.each(function () {
            $(this).unbind().on("click", function (event) {
                event.preventDefault();
                var url = location.href;
                if (url) {
                    if(typeof MainContent == "function"){
                    var mainContent = new MainContent();
                    mainContent.set({
                        url: url,
                        onBeforeSend: function (xhr) {
                            Swal({
                                showCloseButton: true,
                                allowOutsideClick: false,
                                onBeforeOpen: () => {
                                    Swal.showLoading();
                                },
                                onClose: () => {
                                    mainContent.stop();
                                }
                            });
                        },
                        onSuccess: function (response, newDocument) {
                            if (response) {
                                Swal.close();
                                var newMaincontent = $(newDocument).find("div.main-content"),
                                    oldMaincontent = $(event.target).parents(".main-content:first");

                                oldMaincontent.html(newMaincontent.html());

                                $.getScript(location.origin + "/assets/js/argon.min.js");
                            }
                        }
                    });
                    mainContent.load();
                    }
                }
            });
        });
    })(),
    Report = (function () {
        var e = $('[data-toggle="report"]');
        e.length && e.each(function () {
            $(this).unbind().on("click", function (event) {
                event.preventDefault();
                var url = location.href;
                window.open(url.match(/list/g) ? url.replace("list", "report") : url + '/report');
            });
        });
    })();

$('[data-toggle="collapse-table"]').unbind().on("click", function (event) {
    event.preventDefault();
    var self = $(this);
    var dataCollapse = "";
    var target = $(this).attr("data-target");
    if ($(target).hasClass("show")) {
        $(target).collapse("hide").removeClass("collapsing");
    } else {
        $(target).collapse("show").addClass("collapse show");
        $(target).length && $(target).each(function () {
            dataCollapse += this.outerHTML;
            $(this).remove();
        });

        self.parents("tr").after(dataCollapse);
    }
});

var ThemeColor = (function () {
        var e = $('[data-toggle="theme_color"]');
        e.length && e.each(function () {
            $(this).unbind().on("click", function (event) {
                event.preventDefault();
                var theme_color = $(this).data("color-name");
                var data_theme_id = $(this).data("id");
                var selected = $('<div class="selected"><div class="selected-item-wrap"><i class="fas fa-check"></i></div></div>');
                if (!$(this).find(".selected").length) {
                    $.ajax({
                        url: location.href + "/set/" + data_theme_id,
                        method: "POST",
                        success: response => {
                            if (response.success) {
                                $(this).parents("#target_colors").find(".selected").remove();
                                var oldThemeBg = $("[data-theme-bg-color]");
                                oldThemeBg.removeClass("bg-" + oldThemeBg.attr("data-theme-bg-color"));
                                oldThemeBg.addClass("bg-" + theme_color);
                                oldThemeBg.attr("data-theme-bg-color", theme_color);
                                $(this).find(".color-swatch-header").html(selected);
                                swal({
                                    title: response.message.title,
                                    text: response.message.text,
                                    type: "success",
                                    buttonsStyling: !1,
                                    confirmButtonClass: "btn btn-primary",
                                    confirmButtonText: response.message.button.confirm
                                });
                            }
                        }
                    });
                }
            });
        });
    })(),
    ViewerImage = (function () {
        var e = $('[data-toggle="gallery"]');
        e.length && e.each(function () {
            var viewer = new Viewer(this, {
                url: "data-original",
                title: function (image) {
                    return (image.alt + " (" + (this.index + 1) + "/" + this.length + ")");
                },
                toolbar: {
                    zoomIn: true,
                    zoomOut: true,
                    oneToOne: true,
                    reset: true,
                    prev: true,
                    play: true,
                    next: true,
                    rotateLeft: true,
                    rotateRight: true,
                    flipHorizontal: true,
                    flipVertical: true,
                    download: function () {
                        var a = document.createElement("a");
                        a.href = viewer.image.src;
                        a.download = viewer.image.alt;
                        document.body.appendChild(a);
                        a.click();
                        document.body.removeChild(a);
                    }
                }
            });
        });
    })(),
    TabContent = (function () {
        var e = $('[data-toggle="tab-content"]');
        e.length;
        e.each(function () {
            $(this).unbind().on("click", function (event) {
                event.preventDefault();
                var self = this;
                var url = $(this).attr("href");
                var target = $(this).data("target");
                var ajaxLoad = null;
                var load = $('<span class="loading"><img src="' + location.origin + '/assets/img/icons/LOOn0JtHNzb.gif"></span>');
                var loading = $('<div class="loading row" style="background-color: rgba(0, 0, 0, 0.4); position: absolute; height: 100%; width: 100%; z-index: 2;"><div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);"><div class="spinner-border spinner-3 text-blue"></div></div></div>');
                if (url) {
                    if(typeof MainContent == "function"){
                    var mainContent = new MainContent();
                    mainContent.set({
                        url: url,
                        onBeforeSend: function (xhr) {
                            $(self).find(".title").append(load);
                            $(target).parent().parent().prepend(loading);
                            $(self).parent().find(".active").removeClass("active");
                        },
                        onSuccess: function (response, newDocument) {
                            if (response) {
                                load.remove();
                                loading.remove();
                                $(self).addClass("active");
                                var newMaincontent = $(newDocument).find("div.main-content");
                                $(target).html(newMaincontent.find(target).html());
                                $.getScript(location.origin + "/assets/js/argon.min.js");
                            }
                        }
                    });

                    mainContent.load();
                }
            }
            });
        });
    })(),
    LocationAddress = (function () {
        var e = $('[name="location"]');
        e.length && e.each(function () {
            $(this).on("input", function () {
                var target = $(this).data("target");

                var iframe = GoogleMapsURLToEmbedURL($(this).val());
                console.log($(target), iframe);
                $(target).attr("src", iframe);
            });
        });
    })(),
    Weather = (function () {
        var e = $('[data-toggle="weather"]');
        if (e.length) {
            e.find(".fahrenheit").hide();
            e.find(".title").hide();
            e.find("#todayF").hide();
            e.find("#tomorrowF").hide();
            e.find("#afterTomorrowF").hide();
            e.find("#afterAfterTomorrowF").hide();
            var latitude;
            var longitude;

            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(function (location) {
                    latitude = location.coords.latitude;
                    longitude = location.coords.longitude;

                    var geolocation = "https://maps.googleapis.com/maps/api/geocode/json?latlng=" + latitude + "%2C" + longitude + "&language=km&key=AIzaSyBfY6ipJn-hvZ6O6VndRfp8yI9nOYovsuM";

                    setTimeout(function () {
                        e.removeClass("d-none");
                        $("div").removeClass("loader");
                    }, 1500);
                    var api = "https://fcc-weather-api.glitch.me/api/current?lat=" + latitude + "&lon=" + longitude + "";
                    $.getJSON(api).done(function (location) {
                        if (location) {
                            if (location.coord.lat == latitude.toFixed(2) && location.coord.lon == longitude.toFixed(2)) {
                                e.find("#location").html(location.name);
                            }
                        }
                    });

                    var url = "https://api.darksky.net/forecast/e7ea57ca52da5ae872c7c0c343f312be/" + latitude + "," + longitude + "?callback=?&units=si";
                    $.getJSON(url, function (data) {
                        var temp = data.currently.temperature;
                        var fahrenheit = ((data.currently.temperature * 9) / 5 + 32).toFixed(1) + "&deg;F";
                        var celsius = data.currently.temperature.toFixed(1) + "&deg;C";
                        var description = data.currently.summary;
                        var icon = "wi wi-forecast-io-" + data.currently.icon;
                        var wind = " " + data.currently.windSpeed.toFixed(1) + " m/s ";
                        var humidity = " " + (data.currently.humidity * 100).toFixed(0) + " %";

                        //bloody timeout so you can see the loading bars
                        setTimeout(function () {
                            e.find("#icon").html('<i class="' + icon + '">');
                            e.find("#description").html(description);
                            e.find("#humidity").html(humidity);
                            e.find("#wind").html(wind);
                            e.find(".celsius").html(celsius);
                            e.find(".fahrenheit").html(fahrenheit);

                            //today forecast in C
                            var todayMaxTemp = data.daily.data[0].temperatureMax.toFixed(0);
                            var todayMinTemp = data.daily.data[0].temperatureMin.toFixed(0);
                            var todayIcon = "wi wi-forecast-io-" + data.daily.data[0].icon;
                            e.find("#todayC").html("<br>" + todayMinTemp + "&deg;/" + todayMaxTemp + '&deg; <br> <i class="' + todayIcon + '" id="smallIcon">');
                            //today forecast in F
                            var todayMaxTemp = ((data.daily.data[0].temperatureMax * 9) / 5 + 32).toFixed(0);
                            var todayMinTemp = ((data.daily.data[0].temperatureMin * 9) / 5 + 32).toFixed(0);
                            var todayIcon = "wi wi-forecast-io-" + data.daily.data[0].icon;
                            e.find("#todayF").html("<br>" + todayMinTemp + "&deg;/" + todayMaxTemp + '&deg; <br> <i class="' + todayIcon + '" id="smallIcon">');

                            //tomorrow forecast in C
                            var tomorrowMaxTemp = data.daily.data[1].temperatureMax.toFixed(0);
                            var tomorrowMinTemp = data.daily.data[1].temperatureMin.toFixed(0);
                            var tomorrowIcon = "wi wi-forecast-io-" + data.daily.data[1].icon;
                            e.find("#tomorrowC").html("<br>" + tomorrowMinTemp + "&deg;/" + tomorrowMaxTemp + '&deg; <br> <i class="' + tomorrowIcon + '" id="smallIcon">');
                            //tomorrow forecast in F
                            var tomorrowMaxTemp = ((data.daily.data[1].temperatureMax * 9) / 5 + 32).toFixed(0);
                            var tomorrowMinTemp = ((data.daily.data[1].temperatureMin * 9) / 5 + 32).toFixed(0);
                            var tomorrowIcon = "wi wi-forecast-io-" + data.daily.data[1].icon;
                            e.find("#tomorrowF").html("<br>" + tomorrowMinTemp + "&deg;/" + tomorrowMaxTemp + '&deg; <br> <i class="' + tomorrowIcon + '" id="smallIcon">');

                            //after tomorrow forecast in C
                            var afterTomorrowMaxTemp = data.daily.data[2].temperatureMax.toFixed(0);
                            var afterTomorrowMinTemp = data.daily.data[2].temperatureMin.toFixed(0);
                            var afterTomorrowIcon = "wi wi-forecast-io-" + data.daily.data[2].icon;
                            e.find("#afterTomorrowC").html("<br>" + afterTomorrowMinTemp + "&deg;/" + afterTomorrowMaxTemp + '&deg; <br> <i class="' + afterTomorrowIcon + '" id="smallIcon">');
                            //after tomorrow forecast in F
                            var afterTomorrowMaxTemp = ((data.daily.data[2].temperatureMax * 9) / 5 + 32).toFixed(0);
                            var afterTomorrowMinTemp = ((data.daily.data[2].temperatureMin * 9) / 5 + 32).toFixed(0);
                            var afterTomorrowIcon = "wi wi-forecast-io-" + data.daily.data[2].icon;
                            e.find("#afterTomorrowF").html("<br>" + afterTomorrowMinTemp + "&deg;/" + afterTomorrowMaxTemp + '&deg; <br> <i class="' + afterTomorrowIcon + '" id="smallIcon">');

                            //after after tomorrow forecast in C :))
                            var afterAfterTomorrowMaxTemp = data.daily.data[3].temperatureMax.toFixed(0);
                            var afterAfterTomorrowMinTemp = data.daily.data[3].temperatureMin.toFixed(0);
                            var afterAfterTomorrowIcon = "wi wi-forecast-io-" + data.daily.data[3].icon;
                            e.find("#afterAfterTomorrowC").html("<br>" + afterAfterTomorrowMinTemp + "&deg;/" + afterAfterTomorrowMaxTemp + '&deg; <br> <i class="' + afterAfterTomorrowIcon + '" id="smallIcon">');
                            //after after tomorrow forecast in F :))
                            var afterAfterTomorrowMaxTemp = ((data.daily.data[3].temperatureMax * 9) / 5 + 32).toFixed(0);
                            var afterAfterTomorrowMinTemp = ((data.daily.data[3].temperatureMin * 9) / 5 + 32).toFixed(0);
                            var afterAfterTomorrowIcon = "wi wi-forecast-io-" + data.daily.data[3].icon;
                            e.find("#afterAfterTomorrowF").html("<br>" + afterAfterTomorrowMinTemp + "&deg;/" + afterAfterTomorrowMaxTemp + '&deg; <br> <i class="' + afterAfterTomorrowIcon + '" id="smallIcon">');
                            e.find(".title").show();
                        }, 1000);
                        // end of timeout

                        //temp toggle
                        e.find(".fahrenheit-btn").on("click", function () {
                            e.find(".celsius").hide();
                            e.find("#todayC").hide();
                            e.find("#tomorrowC").hide();
                            e.find("#afterTomorrowC").hide();
                            e.find("#afterAfterTomorrowC").hide();
                            e.find(".fahrenheit").show(fahrenheit);
                            e.find("#todayF").show();
                            e.find("#tomorrowF").show();
                            e.find("#afterTomorrowF").show();
                            e.find("#afterAfterTomorrowF").show();
                        });

                        e.find(".celsius-btn").on("click", function () {
                            e.find(".fahrenheit").hide();
                            e.find("#todayF").hide();
                            e.find("#tomorrowF").hide();
                            e.find("#afterTomorrowF").hide();
                            e.find("#afterAfterTomorrowF").hide();
                            e.find(".celsius").show(celsius);
                            e.find("#todayC").show();
                            e.find("#tomorrowC").show();
                            e.find("#afterTomorrowC").show();
                            e.find("#afterAfterTomorrowC").show();
                        });

                        //  end of temp toggle
                    });
                });
            } else {
                alert("We couldn` retrieve your location, please check your location settings");
            }
        }
    })();

var CheckBoxLimit = (function () {
        var e = $('[data-toggle="checkbox-limit"]');
        e.length && e.each(function () {
            var self = $(this);
            var limit = $(this).data("limit");
            self.find("input").change(function () {
                if (self.find("input:checked").length > limit) {
                    this.checked = false;
                }
            });
        });
    })(),
    // NavBar = (function () {
    //     if(typeof MainContent == "function"){
    //     var mainContent = new MainContent();
    //     var e = $('[data-toggle="navbar"]');
    //     e.length &&
    //         e.unbind().on("click", function (event) {
    //             event.preventDefault();
    //             var self = $(this);
    //             var loadstyle = self.data("loadstyle");
    //             var loadscript = self.data("loadscript");

    //             if (!self.hasClass("loading")) {
    //                 self.addClass("loading");
    //                 var url = self.attr("href");
    //                 if (url) {
    //                     var load = $('<span class="loading ml-2"><img src="' + location.origin + '/assets/img/icons/LOOn0JtHNzb.gif"></span>');
    //                     var loading = $('<div class="loading" style="background-color: rgba(0, 0, 0, 0.4); position: absolute; height: 100%; width: 100%; z-index: 2;"><div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);"><div class="spinner-border spinner-3 text-blue"></div></div></div>');
    //                     mainContent.set({
    //                         url: url,
    //                         onBeforeSend: function (xhr) {
    //                             $("div.main-content").prepend(loading);
    //                             self.append(load);
    //                             self.parent().parent().parent().find(".active").removeClass("active").removeClass("text-blue");
    //                         },
    //                         onSuccess: function (response, newDocument) {
    //                             if (response) {
    //                                 var urlhelper = new UrlHelper();
    //                                 urlhelper.set(url, url);

    //                                 load.remove();
    //                                 loading.remove();
    //                                 self.removeClass("loading");
    //                                 self.addClass("active text-blue");
    //                                 var newTitle = $(newDocument).find("title");
    //                                 var newMaincontent = $(newDocument).find("div.main-content");
    //                                 var newTopMaincontent = newMaincontent.find(">nav.navbar.navbar-top");
    //                                 var newHeaderMaincontent = newMaincontent.find(">.header");
    //                                 var newPageMaincontent = newMaincontent.find(">.page-content");

    //                                 var oldTitle = $("title");
    //                                 var oldMaincontent = $("div.main-content");
    //                                 var oldTopMaincontent = oldMaincontent.find(">nav.navbar.navbar-top");
    //                                 var oldHeaderMaincontent = oldMaincontent.find(">.header");
    //                                 var oldPageMaincontent = oldMaincontent.find(">.page-content");
    //                                 oldTitle.text(newTitle.text());
    //                                 oldHeaderMaincontent.html(newHeaderMaincontent.html());
    //                                 oldPageMaincontent.html(newPageMaincontent.html());
    //                                 if (newPageMaincontent.length == 0 || oldPageMaincontent.length == 0) {
    //                                     oldMaincontent.html(newMaincontent.html());
    //                                 }

    //                                 if (loadstyle) {
    //                                     $.each(loadstyle, (i, link) => {
    //                                         var style = $("<link>").attr({
    //                                             rel: "stylesheet",
    //                                             href: link,
    //                                             type: "text/css",
    //                                         });
    //                                         $("head").append(style);
    //                                     });
    //                                 }
    //                                 if (loadscript) {
    //                                     $.each(loadscript, (i, script) => {
    //                                         $.getScript(script);
    //                                     });
    //                                 }

    //                                 $.getScript(location.origin + "/assets/js/argon.min.js");
    //                             }
    //                         }
    //                     });
    //                     mainContent.load();
    //                 }
    //             }
    //         });
    //     }
    // })(),
    // shortcutIcon = (function () {
    //     if(typeof MainContent == "function"){
    //     var mainContent = new MainContent();
    //     var e = $('[data-toggle="shortcut-icon"]');
    //     e.length &&
    //         e.unbind().on("click", function (event) {
    //             e.find(".shortcut-media").find(".loading").remove();
    //             event.preventDefault();
    //             var self = $(this);
    //             var loadscript = self.data("loadscript");
    //             if (!self.hasClass("loading")) {
    //                 self.addClass("loading");
    //                 var url = self.attr("href");
    //                 if (url) {
    //                     var loading = $('<div class="loading" style="position: absolute;width: 100%;z-index: 2;"><div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);"><div class="spinner-border spinner-3 text-blue"></div></div></div>');
    //                     mainContent.set({
    //                         url: url,
    //                         onBeforeSend: function (xhr) {
    //                             self.find(".shortcut-media").prepend(loading);
    //                         },
    //                         onSuccess: function (response, newDocument) {
    //                             if (response) {
    //                                 var urlhelper = new UrlHelper();
    //                                 urlhelper.set(url, url);
    //                                 loading.remove();
    //                                 self.removeClass("loading");
    //                                 var newTitle = $(newDocument).find("title");
    //                                 var newMaincontent = $(newDocument).find("div.main-content");
    //                                 var newTopMaincontent = newMaincontent.find(">nav.navbar.navbar-top");
    //                                 var newHeaderMaincontent = newMaincontent.find(">.header");
    //                                 var newPageMaincontent = newMaincontent.find(">.page-content");

    //                                 var oldTitle = $("title");
    //                                 var oldMaincontent = $("div.main-content");
    //                                 var oldTopMaincontent = oldMaincontent.find(">nav.navbar.navbar-top");
    //                                 var oldHeaderMaincontent = oldMaincontent.find(">.header");
    //                                 var oldPageMaincontent = oldMaincontent.find(">.page-content");
    //                                 oldTitle.text(newTitle.text());
    //                                 oldHeaderMaincontent.html(newHeaderMaincontent.html());
    //                                 oldPageMaincontent.html(newPageMaincontent.html());
    //                                 if (newPageMaincontent.length == 0 || oldPageMaincontent.length == 0) {
    //                                     oldMaincontent.html(newMaincontent.html());
    //                                 }
    //                                 if (loadscript) {
    //                                     $.each(loadscript, (i, script) => {
    //                                         $.getScript(script);
    //                                     });
    //                                 }
    //                                 $.getScript(location.origin + "/assets/js/argon.min.js");
    //                             }
    //                         }
    //                     });
    //                     mainContent.load();
    //                 }
    //             }
    //         });
    //     }
    // })(),
    // PopState = (function () {
    //     if(typeof MainContent == "function"){
    //         var mainContent = new MainContent();
    //         window.onpopstate = function (event) {
    //             if (event.state) {
    //                 $('[data-toggle="navbar"]').parent().parent().parent().find(".active").removeClass("active").removeClass("text-blue");
    //                 $.each($('[data-toggle="navbar"]'), function () {
    //                     var link = $(this).attr("href");
    //                     if (event.state.match(link)) {
    //                         var loadstyle = $(this).data("loadstyle");
    //                         var loadscript = $(this).data("loadscript");
    //                         $(this).addClass("active text-blue");
    //                         var loading = $('<div class="loading" style="background-color: rgba(0, 0, 0, 0.4); position: absolute; height: 100%; width: 100%; z-index: 2;"><div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);"><div class="spinner-border spinner-3 text-blue"></div></div></div>');
    //                         mainContent.set({
    //                             url: event.state,
    //                             onBeforeSend: function (xhr) {
    //                                 $("div.main-content").prepend(loading);
    //                             },
    //                             onSuccess: function (response, newDocument) {
    //                                 if (response) {
    //                                     loading.remove();
    //                                     var newTitle = $(newDocument).find("title");
    //                                     var newMaincontent = $(newDocument).find("div.main-content");
    //                                     var newTopMaincontent = newMaincontent.find(">nav.navbar.navbar-top");
    //                                     var newHeaderMaincontent = newMaincontent.find(">.header");
    //                                     var newPageMaincontent = newMaincontent.find(">.page-content");

    //                                     var oldTitle = $("title");
    //                                     var oldMaincontent = $("div.main-content");
    //                                     var oldTopMaincontent = oldMaincontent.find(">nav.navbar.navbar-top");
    //                                     var oldHeaderMaincontent = oldMaincontent.find(">.header");
    //                                     var oldPageMaincontent = oldMaincontent.find(">.page-content");
    //                                     oldTitle.text(newTitle.text());
    //                                     oldHeaderMaincontent.html(newHeaderMaincontent.html());
    //                                     oldPageMaincontent.html(newPageMaincontent.html());
    //                                     if (newPageMaincontent.length == 0 || oldPageMaincontent.length == 0) {
    //                                         oldMaincontent.html(newMaincontent.html());
    //                                     }
    //                                     if (loadstyle) {
    //                                         $.each(loadstyle, (i, link) => {
    //                                             var style = $("<link>").attr({
    //                                                 rel: "stylesheet",
    //                                                 href: link,
    //                                                 type: "text/css",
    //                                             });
    //                                             $("head").append(style);
    //                                         });
    //                                     }
    //                                     if (loadscript) {
    //                                         $.each(loadscript, (i, script) => {
    //                                             $.getScript(script);
    //                                         });
    //                                     }
    //                                     $.getScript(location.origin + "/assets/js/argon.min.js");
    //                                 }
    //                             }
    //                         });
    //                         mainContent.load();
    //                     }

    //                 });
    //             }
    //         }
    //     }

    // })(),

activityWatcher = function (){

    var activityReload = false;
    //The number of seconds that have passed
    //since the user was active.
    var secondsSinceLastActivity = 0;

    //Five minutes. 60 x 2 = 120 seconds.
    var maxInactivity = (60 * 2);

    //Setup the setInterval method to run
    //every second. 1000 milliseconds = 1 second.

    var inIterval = setInterval(function(){
        secondsSinceLastActivity++;
        //if the user has been inactive or idle for longer
        //then the seconds specified in maxInactivity
        if(secondsSinceLastActivity > maxInactivity){
            //Redirect them to your logout.php page.
           // location.href = 'logout.php';
           clearInterval(inIterval);
        }
    }, 1000);

    //The function that will be called whenever a user is active
    function activity(){
        //reset the secondsSinceLastActivity variable
        //back to 0
        if( activityReload == false){
            if(secondsSinceLastActivity > maxInactivity){
                activityReload = true;
                location.reload();
            }else{
                secondsSinceLastActivity = 0;
            }
        }

    }

    //An array of DOM events that should be interpreted as
    //user activity.
    var activityEvents = [
        'mousedown', 'mousemove', 'keydown',
        'scroll','DOMMouseScroll', 'touchstart','touchmove','MSPointerMove'
    ];

    //add these events to the document.
    //register the activity function as the listener parameter.
    activityEvents.forEach(function(eventName) {
        document.addEventListener(eventName, activity, true);
    });


}

//activityWatcher();

var ReadPDF = (function(){
    var canvas = $('<canvas width="1000" class="d-none">');
    var canvas_ctx = canvas.get(0).getContext('2d');
    var e = $('[data-toggle="read-pdf"]');
        e.length &
        e.on("change",function(event){
            var pdf = (event.target.files[0]);
            var target = $(this).data("target");
                if($(target).length){
                    $(target).after(canvas);
                    showPDF(URL.createObjectURL(pdf),1,$(target));

                }

        });
 var total_pages = 0;

    function showPDF(pdf_url,show_page = 1,target) {

        PDFJS.getDocument({ url: pdf_url }).then(function(pdf_doc) {
            total_pages = pdf_doc.pdfInfo.numPages;
            pdf_doc.getPage(show_page).then(function(page) {

                var scale_required = canvas.get(0).width / page.getViewport(1).width;
                var viewport = page.getViewport(scale_required);
                    canvas.get(0).height = viewport.height;
                var renderContext = {
                    canvasContext: canvas_ctx,
                    viewport: viewport
                };
                page.render(renderContext).then(function() {
                    target.attr("src",canvas.get(0).toDataURL());
                    total_pages = pdf_doc.numPages;
                    target.parents("form").find('[name="image"]').val('').attr("data-pdf-info",JSON.stringify({
                        total_pages : total_pages,
                        show_page : show_page,
                        base64 : canvas.get(0).toDataURL()
                    }));
                });

            });

        });




    }


})();
